<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>ZEN.COM – Select Payment Method</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --Background: #FFFFFF;
    --Primary: #222222;
    --Secondary: #727272;
    --Tertiary: #A3A3A3;
    --Disabled: #B5B5B5;
    --SurfaceSuperLight: #FAFAFA;
    --SurfaceLight: #F7F7F7;
    --SurfaceMedium: #EBEBEB;
    --SurfaceStrong: #DFDFDF;
    --GraphSecondary: #CCCCCC;
    --Contrary: #FFFFFF;
  }

  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--Background);
    color: var(--Primary);
    min-height: 100vh;
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
  }

  .page {
    display: flex;
    width: 100%;
    max-width: 1440px;
    margin: 0 auto;
    padding-top: 100px;
    padding-bottom: 60px;
    flex-direction: column;
    align-items: center;
    gap: 142px;
    background: var(--Background);
    flex: 1;
  }

  .content {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 64px;
  }

  /* ── Left column ── */
  .left-col {
    width: 552px;
    max-width: 552px;
    flex-shrink: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 24px;
    position: relative;
  }

  .header-row {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .header-title {
    font-size: 24px;
    font-weight: 700;
    line-height: 32px;
    color: var(--Primary);
  }

  .header-subtitle {
    font-size: 14px;
    font-weight: 500;
    line-height: 18px;
    color: var(--Secondary);
    margin-top: 4px;
  }

  .country-selector {
    display: flex;
    flex-direction: column;
    gap: 2px;
    width: 141px;
  }

  .country-label {
    font-size: 11px;
    font-weight: 400;
    line-height: 14px;
    color: var(--Secondary);
  }

  .country-value-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 20px;
  }

  .country-value {
    font-size: 14px;
    font-weight: 600;
    line-height: 16px;
    color: var(--Primary);
  }

  .country-chevron svg { display: block; }

  .country-underline {
    height: 1px;
    background: var(--Secondary);
    margin-top: 4px;
  }

  /* ── Payment list card ── */
  .payment-card {
    width: 100%;
    border-radius: 24px;
    border: 1px solid var(--SurfaceStrong);
    box-shadow: 0 24px 114px rgba(0,0,0,0.06);
    overflow: visible;
    display: flex;
    flex-direction: column;
  }

  /* First/last child rounding (since overflow:visible) */
  .payment-card > *:first-child {
    border-radius: 24px 24px 0 0;
  }

  .payment-card > *:last-child {
    border-radius: 0 0 24px 24px;
  }

  /* ── Generic payment item ── */
  .payment-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 24px 24px 24px 27px;
    background: var(--Background);
    cursor: pointer;
    transition: background 0.15s;
  }

  .payment-item:hover {
    background: var(--SurfaceSuperLight);
  }

  /* Separators via .payment-separator */
  .payment-separator {
    height: 0;
    border: none;
    border-top: 1px solid var(--SurfaceMedium);
    margin: 0;
    flex-shrink: 0;
    transition: opacity 0.25s ease;
  }

  .payment-item-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .pm-icon {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    background: var(--SurfaceSuperLight);
    border: 1px solid var(--SurfaceMedium);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    position: relative;
  }

  .pm-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .pm-name-row {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .pm-name {
    font-size: 14px;
    font-weight: 700;
    line-height: 18px;
    color: var(--Primary);
  }

  .pm-desc {
    font-size: 11px;
    font-weight: 500;
    line-height: 14px;
    color: var(--Secondary);
  }

  /* ── Expanded Card payment item ── */
  .payment-item-expanded {
    display: flex;
    padding: 24px;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start;
    gap: 16px;
    align-self: stretch;
    border-radius: 20px;
    border: 3px solid var(--Primary);
    background: #FFF;
    /* animation */
    overflow: hidden;
    transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .payment-item-expanded + .payment-item {
    border-top: 1px solid var(--SurfaceMedium);
  }

  .payment-item-expanded .payment-item-left {
    cursor: pointer;
  }

  /* Click to Pay button */
  .c2p-btn {
    display: inline-flex;
    height: 40px;
    min-width: 96px;
    padding: 12px 24px;
    background: var(--Background);
    border-radius: 24px;
    border: 2px solid var(--Primary);
    align-items: center;
    gap: 10px;
    cursor: pointer;
    transition: background .15s;
  }

  .c2p-btn:hover {
    background: var(--SurfaceSuperLight);
  }

  .c2p-brands {
    display: inline-flex;
    padding: 4px 8px;
    background: white;
    border-radius: 4px;
    border: 0.5px solid var(--SurfaceStrong);
    align-items: center;
  }

  .c2p-brands svg { display: block; }

  .c2p-text {
    font-size: 14px;
    font-weight: 700;
    line-height: 16px;
    color: var(--Primary);
    white-space: nowrap;
  }

  /* ── Form fields ── */
  .card-form {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 32px;
  }

  .fields-group {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
  }

  .field {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex: 1 1 0;
  }

  .field-label {
    font-size: 12px;
    font-weight: 400;
    line-height: 16px;
    color: var(--Secondary);
  }

  .field-input-wrap {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .field-input-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 30px;
  }

  .field-input-row input {
    flex: 1;
    border: none;
    outline: none;
    background: transparent;
    font-size: 16px;
    font-family: 'Nunito', sans-serif;
    font-weight: 600;
    line-height: 20px;
    color: var(--Primary);
    padding: 0;
  }

  .field-input-row input::placeholder {
    color: var(--Secondary);
    font-weight: 600;
  }

  .field-input-row input:focus::placeholder {
    color: var(--Tertiary);
  }

  .field-icon {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
    margin-right: 8px;
  }
  #cardFieldIcon {
    width: 32px;
    justify-content: center;
    position: relative;
  }
  #cardFieldIcon svg {
    position: absolute;
    transition: opacity 0.2s;
    flex-shrink: 0;
  }
  #cardFieldIcon.brand-active svg {
    opacity: 0;
    pointer-events: none;
  }
  #cardFieldIcon img {
    width: 32px;
    height: 20px;
    object-fit: contain;
    display: block;
    opacity: 0;
    transform: scale(0.85);
    transition: opacity 0.2s, transform 0.2s;
    position: relative;
  }
  #cardFieldIcon img.visible {
    opacity: 1;
    transform: scale(1);
  }

  .field-action {
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }

  .field-underline {
    height: 1px;
    background: var(--Secondary);
    margin-top: 6px;
    transition: background .2s;
  }

  .field:focus-within .field-underline {
    background: var(--Primary);
    height: 2px;
    margin-top: 5px;
  }

  /* ── Field validation error state ── */
  .field.error .field-underline {
    height: 4px;
    margin-top: 3px;
    background: url("data:image/svg+xml,%3Csvg width='504' height='4' viewBox='0 0 504 4' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 3L5.41612 1L10.8322 3L16.2484 1L21.6645 3L27.0806 1L32.4967 3L37.9128 1L43.329 3L48.7451 1L54.1612 3L59.5773 1L64.9934 3L70.4096 1L75.8257 3L81.2418 1L86.6579 3L92.074 1L97.4902 3L102.906 1L108.322 3L113.706 1L119.09 3L124.474 1L129.858 3L135.242 1L140.626 3L146.01 1L151.393 3L156.777 1L162.161 3L167.545 1L172.929 3L178.313 1L183.697 3L189.081 1L194.464 3L199.848 1L205.232 3L210.616 1L216 3L221.416 1L226.832 3L232.248 1L237.664 3L243.081 1L248.497 3L253.913 1L259.329 3L264.745 1L270.161 3L275.577 1L280.993 3L286.41 1L291.826 3L297.242 1L302.658 3L308.074 1L313.49 3L318.906 1L324.322 3L329.706 1L335.09 3L340.474 1L345.858 3L351.242 1L356.626 3L362.01 1L367.393 3L372.777 1L378.161 3L383.545 1L388.929 3L394.313 1L399.697 3L405.081 1L410.465 3L415.848 1L421.232 3L426.616 1L432 3L437.416 1L442.832 3L448.248 1L453.664 3L459.081 1L464.497 3L469.913 1L475.329 3L480.745 1L486.161 3L491.577 1L496.993 3L502.41 1' stroke='%23222222' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E") repeat-x left center;
    transition: none;
  }
  .field.error:focus-within .field-underline {
    height: 4px;
    margin-top: 3px;
    background: url("data:image/svg+xml,%3Csvg width='504' height='4' viewBox='0 0 504 4' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 3L5.41612 1L10.8322 3L16.2484 1L21.6645 3L27.0806 1L32.4967 3L37.9128 1L43.329 3L48.7451 1L54.1612 3L59.5773 1L64.9934 3L70.4096 1L75.8257 3L81.2418 1L86.6579 3L92.074 1L97.4902 3L102.906 1L108.322 3L113.706 1L119.09 3L124.474 1L129.858 3L135.242 1L140.626 3L146.01 1L151.393 3L156.777 1L162.161 3L167.545 1L172.929 3L178.313 1L183.697 3L189.081 1L194.464 3L199.848 1L205.232 3L210.616 1L216 3L221.416 1L226.832 3L232.248 1L237.664 3L243.081 1L248.497 3L253.913 1L259.329 3L264.745 1L270.161 3L275.577 1L280.993 3L286.41 1L291.826 3L297.242 1L302.658 3L308.074 1L313.49 3L318.906 1L324.322 3L329.706 1L335.09 3L340.474 1L345.858 3L351.242 1L356.626 3L362.01 1L367.393 3L372.777 1L378.161 3L383.545 1L388.929 3L394.313 1L399.697 3L405.081 1L410.465 3L415.848 1L421.232 3L426.616 1L432 3L437.416 1L442.832 3L448.248 1L453.664 3L459.081 1L464.497 3L469.913 1L475.329 3L480.745 1L486.161 3L491.577 1L496.993 3L502.41 1' stroke='%23222222' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E") repeat-x left center;
  }
  .field-error-msg {
    font-size: 11px;
    color: #222222;
    font-weight: 600;
    margin-top: 4px;
    display: none;
    padding-left: 2px;
  }
  .field.error .field-error-msg { display: block; }

  /* ── CVV Tooltip ── */
  .cvv-info { position: relative; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 20px; height: 20px; border-radius: 50%; border: 1.5px solid #A3A3A3; font-size: 11px; font-weight: 700; color: #727272; transition: border-color 0.15s, color 0.15s; user-select: none; }
  .cvv-info:hover { border-color: #222; color: #222; }
  .cvv-tooltip-popup {
    position: absolute;
    bottom: calc(100% + 8px);
    right: 0;
    background: #fff;
    border: 1px solid #DFDFDF;
    border-radius: 10px;
    padding: 12px 14px;
    width: 200px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    z-index: 100;
    display: none;
    pointer-events: none;
  }
  .cvv-tooltip-popup.visible { display: block; }
  .cvv-tooltip-card {
    width: 100%;
    height: 60px;
    border-radius: 6px;
    background: linear-gradient(135deg, #1c2e4a 0%, #243b6e 100%);
    position: relative;
    margin-bottom: 8px;
    overflow: hidden;
  }
  .cvv-tooltip-card-stripe { position: absolute; top: 14px; left: 0; right: 0; height: 14px; background: rgba(0,0,0,0.5); }
  .cvv-tooltip-card-cvv {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: #fff;
    border-radius: 4px;
    padding: 2px 8px;
    font-size: 11px;
    font-weight: 700;
    color: #222;
    font-family: monospace;
    border: 1.5px solid #CC3333;
  }
  .cvv-tooltip-text { font-size: 11px; color: #555; font-weight: 500; line-height: 1.4; font-family: 'Nunito', sans-serif; }

  .field-row {
    display: flex;
    gap: 20px;
  }

  /* ── Checkboxes ── */
  .options-group {
    display: flex;
    flex-direction: column;
    gap: 16px;
    width: 100%;
  }

  .save-card-section {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .checkbox-row {
    display: flex;
    align-items: center;
    gap: 10px;
    height: 22px;
    cursor: pointer;
  }

  .checkbox-box {
    width: 22px;
    height: 22px;
    border-radius: 4px;
    border: 2px solid var(--Primary);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: background .15s, border-color .15s;
  }

  .checkbox-box.checked {
    background: var(--Primary);
    border-color: var(--Primary);
  }

  .checkbox-box svg {
    display: block;
    opacity: 0;
    transition: opacity .15s;
  }

  .checkbox-box.checked svg {
    opacity: 1;
  }

  .checkbox-label-row {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
  }

  .checkbox-label {
    font-size: 14px;
    font-weight: 700;
    line-height: 18px;
    color: var(--Primary);
  }

  .save-card-sub {
    padding-left: 32px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .save-card-sub-text {
    font-size: 11px;
    font-weight: 500;
    line-height: 14px;
    color: var(--Secondary);
  }

  .save-card-sub-bold {
    font-size: 11px;
    font-weight: 700;
    line-height: 14px;
    color: var(--Secondary);
  }

  .learn-more {
    font-size: 11px;
    font-weight: 700;
    line-height: 14px;
    color: var(--Primary);
    text-decoration: none;
    border-bottom: 1px solid var(--Primary);
    cursor: pointer;
  }

  .bottom-options-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    width: 100%;
  }

  .ssl-badge {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .ssl-badge span {
    font-size: 10px;
    font-weight: 500;
    line-height: 12px;
    color: var(--Tertiary);
  }

  /* CVV info icon */
  .cvv-info {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--Secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: help;
    position: relative;
  }

  .cvv-info span {
    font-size: 10px;
    font-weight: 700;
    color: white;
    line-height: 1;
  }

  .card-brands-inline {
    display: inline-flex;
    padding: 4px 8px;
    background: white;
    border-radius: 4px;
    border: 0.5px solid var(--SurfaceStrong);
    align-items: center;
  }

  /* ── Card brand detection opacity ── */
  .card-brands-inline img, .card-brands-inline svg,
  .card-brands-mobile img, .card-brands-mobile svg,
  .brands-chip-small img, .brands-chip-small svg { transition: opacity 0.2s; }
  .brand-visa .visa-logo { opacity: 1 !important; }
  .brand-visa .mc-logo, .brand-visa .amex-logo { opacity: 0.25 !important; }
  .brand-mc .mc-logo { opacity: 1 !important; }
  .brand-mc .visa-logo, .brand-mc .amex-logo { opacity: 0.25 !important; }
  .brand-amex .amex-logo { opacity: 1 !important; }
  .brand-amex .visa-logo, .brand-amex .mc-logo { opacity: 0.25 !important; }

  /* ── Bank logos ── */
  .bank-logos {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .bank-chip {
    width: 33px;
    height: 22px;
    border-radius: 4px;
    border: 0.5px solid var(--SurfaceStrong);
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .bank-more {
    font-size: 9px;
    font-weight: 500;
    line-height: 12px;
    color: var(--Secondary);
  }

  /* Cashback badge */
  .cashback-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    background: #EDFDF0;
    border-radius: 2px;
    border: 1px solid rgba(34, 226, 67, 0.5);
  }

  .cashback-badge span {
    font-size: 9px;
    font-weight: 700;
    line-height: 12px;
    color: #139028;
  }

  .app-only-chip {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    background: white;
    border-radius: 4px;
    border: 0.5px solid var(--SurfaceStrong);
  }

  .app-only-mobile { display: none; }
  .app-only-desktop { display: inline-flex; }
  .card-brands-mobile { display: none; }
  .bank-logos-mobile { display: none; }

  .app-only-chip span {
    font-size: 11px;
    font-weight: 500;
    line-height: 14px;
    color: var(--Secondary);
  }

  /* Show all footer */
  .show-all {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 4px;
    padding: 16px 32px;
    background: var(--SurfaceSuperLight);
    border-top: 1px solid var(--SurfaceLight);
    cursor: pointer;
    transition: background .15s;
  }

  .show-all:hover { background: var(--SurfaceLight); }

  /* Extra methods (collapsible) */
  .extra-methods {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.45s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .extra-methods-inner {
    overflow: hidden;
  }

  .extra-methods.open {
    grid-template-rows: 1fr;
  }

  .show-all span {
    font-size: 12px;
    font-weight: 700;
    line-height: 16px;
    color: var(--Primary);
  }

  /* Trust badges */
  .trust-row {
    display: flex;
    align-items: center;
    gap: 24px;
  }

  .trust-item {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .trust-item span {
    font-size: 10px;
    font-weight: 500;
    line-height: 12px;
    color: var(--Tertiary);
  }

  /* ── Payment secured badge ── */
  .payment-secured {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    position: absolute;
    left: 0;
    right: 0;
  }

  @keyframes badge-glow {
    0%   { filter: none; }
    20%  { filter: sepia(1) saturate(4) hue-rotate(85deg) brightness(1.2)
           drop-shadow(0 0 3px rgba(34,226,67,0.30))
           drop-shadow(0 0 8px rgba(34,226,67,0.15))
           drop-shadow(0 0 18px rgba(34,226,67,0.06))
           drop-shadow(0 0 35px rgba(34,226,67,0.03)); }
    45%  { filter: sepia(1) saturate(5) hue-rotate(85deg) brightness(1.35)
           drop-shadow(0 0 4px rgba(34,226,67,0.60))
           drop-shadow(0 0 12px rgba(34,226,67,0.30))
           drop-shadow(0 0 28px rgba(34,226,67,0.15))
           drop-shadow(0 0 55px rgba(34,226,67,0.06))
           drop-shadow(0 0 80px rgba(34,226,67,0.03)); }
    70%  { filter: sepia(1) saturate(3) hue-rotate(85deg) brightness(1.15)
           drop-shadow(0 0 3px rgba(34,226,67,0.15))
           drop-shadow(0 0 10px rgba(34,226,67,0.06)); }
    100% { filter: none; }
  }

  .payment-secured.shimmer .payment-secured-lock,
  .payment-secured.shimmer .payment-secured-logo {
    animation: badge-glow 1.0s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  @keyframes badge-glow-text {
    0%   { filter: none; }
    20%  { filter: drop-shadow(0 0 3px rgba(34,226,67,0.25))
                   drop-shadow(0 0 8px rgba(34,226,67,0.12)); }
    45%  { filter: drop-shadow(0 0 4px rgba(34,226,67,0.45))
                   drop-shadow(0 0 12px rgba(34,226,67,0.22))
                   drop-shadow(0 0 22px rgba(34,226,67,0.08)); }
    70%  { filter: drop-shadow(0 0 3px rgba(34,226,67,0.18))
                   drop-shadow(0 0 8px rgba(34,226,67,0.08)); }
    100% { filter: none; }
  }

  .payment-secured.shimmer .payment-secured-text {
    animation: badge-glow-text 1.0s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  .payment-secured-lock {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
    opacity: 0.5;
  }

  .payment-secured-text {
    font-size: 12px;
    font-weight: 500;
    color: var(--Tertiary);
    white-space: nowrap;
  }

  .payment-secured-logo {
    height: 18px;
    width: auto;
    flex-shrink: 0;
  }

  /* ── Right column ── */
  .right-col {
    width: 408px;
    max-width: 408px;
    flex-shrink: 1;
    display: flex;
    flex-direction: column;
    gap: 64px;
    position: sticky;
    top: 40px;
    align-self: flex-start;
  }

  .merchant-section {
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .merchant-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .merchant-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .merchant-logo {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    background: var(--Background);
    border: 1px solid var(--SurfaceMedium);
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .merchant-logo img {
    width: 44px;
    height: 44px;
    border-radius: 16px;
    object-fit: cover;
  }

  .merchant-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .merchant-label {
    font-size: 10px;
    font-weight: 500;
    line-height: 12px;
    color: var(--Secondary);
    text-transform: uppercase;
  }

  .merchant-name {
    font-size: 16px;
    font-weight: 700;
    line-height: 20px;
    color: var(--Primary);
  }

  .lang-toggle {
    font-size: 14px;
    font-weight: 700;
    line-height: 16px;
    color: var(--Primary);
    cursor: pointer;
    border-bottom: 1px solid var(--Primary);
    padding-bottom: 1px;
  }

  /* Currency tabs */
  .currency-tabs {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.3s ease;
  }

  .currency-tabs.visible {
    max-height: 80px;
    opacity: 1;
  }

  .currency-tabs-label {
    font-size: 10px;
    font-weight: 500;
    line-height: 12px;
    color: var(--Secondary);
  }

  .currency-tabs-row {
    display: flex;
    gap: 8px;
  }

  .currency-tab {
    height: 32px;
    padding: 0 16px;
    border-radius: 16px;
    border: 2px solid var(--SurfaceStrong);
    background: var(--Background);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: border-color 0.22s cubic-bezier(0.4,0,0.2,1),
                background 0.22s cubic-bezier(0.4,0,0.2,1),
                color 0.22s cubic-bezier(0.4,0,0.2,1),
                transform 0.15s ease;
    font-size: 12px;
    font-weight: 700;
    line-height: 16px;
    color: var(--Primary);
  }

  .currency-tab:hover:not(.active) {
    border-color: var(--Secondary);
    transform: translateY(-1px);
  }

  .currency-tab.active {
    border-color: var(--Primary);
    background: var(--Primary);
    color: white;
  }

  /* BLIK mode: show only PLN pill, non-interactive */
  .currency-tabs.blik-mode .currency-tab:not([data-currency="PLN"]) {
    display: none;
  }
  .currency-tabs.blik-mode .currency-tab[data-currency="PLN"] {
    cursor: default;
    pointer-events: none;
  }
  .currency-tabs.blik-mode .currency-tabs-label::after {
    content: '';
  }

  .total-box {
    padding: 20px;
    background: var(--SurfaceLight);
    border-radius: 8px;
    border: 1px solid var(--SurfaceMedium);
  }

  /* Default: side-by-side (label left, amount right) */
  .total-top-row {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: flex-end;
    gap: 0;
  }

  .total-label {
    font-size: 12px;
    font-weight: 700;
    line-height: 16px;
    color: var(--Secondary);
    text-transform: uppercase;
  }

  .total-amount {
    display: flex;
    align-items: flex-end;
    gap: 2px;
  }

  .total-amount .amount {
    font-size: 34px;
    font-weight: 700;
    line-height: 36px;
    color: var(--Primary);
    transition: opacity 0.18s ease, transform 0.18s ease;
  }

  .total-amount .amount.updating {
    opacity: 0;
    transform: translateY(-6px) scale(0.96);
  }

  .total-amount .currency {
    font-size: 14px;
    font-weight: 700;
    line-height: 18px;
    color: var(--Primary);
    padding-bottom: 2px;
    transition: opacity 0.18s ease, transform 0.18s ease;
  }

  .total-amount .currency.updating {
    opacity: 0;
    transform: translateY(-6px) scale(0.96);
  }

  .exchange-rate-row {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--SurfaceMedium);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .exchange-rate-text {
    font-size: 11px;
    font-weight: 500;
    color: var(--Secondary);
  }

  .exchange-rate-link {
    font-size: 11px;
    font-weight: 600;
    color: var(--Primary);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  /* Continue / Accept order section */
  .continue-section {
    display: flex;
    flex-direction: column;
    gap: 16px;
    align-items: center;
  }

  /* ── Static disabled button (before method selected) ── */
  .static-btn-row {
    display: flex;
    align-items: center;
    width: 100%;
  }

  .static-btn {
    flex: 1;
    height: 60px;
    border-radius: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Nunito', sans-serif;
    font-size: 17px;
    font-weight: 700;
    color: white;
    background: #B5B5B5;
    cursor: not-allowed;
  }

  .terms-text {
    font-size: 11px;
    font-weight: 500;
    line-height: 14px;
    color: var(--Primary);
    text-align: center;
  }

  .terms-text a {
    color: var(--Primary);
    font-weight: 700;
    text-decoration: underline;
  }

  /* ── Bottom bar / stepper ── */
  .bottom-bar {
    width: 100%;
    padding: 8px 16px;
    padding-bottom: max(8px, env(safe-area-inset-bottom));
    background: white;
    border-top: 1px solid var(--SurfaceLight);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 100;
    transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .bottom-bar.visible {
    transform: translateY(0);
  }

  .step {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .step-circle {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    flex-shrink: 0;
  }

  .step-circle.active {
    border: 2px solid var(--Primary);
    color: var(--Primary);
  }

  .step-circle.inactive {
    border: 2px solid var(--SurfaceStrong);
    color: var(--SurfaceStrong);
  }

  .step-text {
    display: flex;
    flex-direction: column;
    gap: 1px;
  }

  .step-title { font-size: 10px; font-weight: 700; line-height: 12px; }
  .step-title.active { color: var(--Primary); }
  .step-title.inactive { color: var(--SurfaceStrong); }

  .step-sub { font-size: 9px; font-weight: 500; line-height: 12px; }
  .step-sub.active { color: var(--Secondary); }
  .step-sub.inactive { color: var(--SurfaceStrong); }

  .step-divider {
    width: 10px;
    height: 2px;
    background: var(--SurfaceStrong);
    border-radius: 100px;
    flex-shrink: 0;
  }

  .pm-icon-overlay {
    position: absolute;
    bottom: -4px;
    right: -4px;
  }

  /* ── Expandable item (shared by BLIK, Card, etc.) ── */
  .expandable-item {
    background: var(--Background);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    padding: 24px;
    border: 3px solid transparent;
    border-radius: 0;
    gap: 0;
    transition: background 0.15s,
                border-color 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                border-radius 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                gap 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .expandable-item.expanded {
    border-radius: 20px;
    border-color: var(--Primary);
    background: #FFF;
    gap: 16px;
    cursor: default;
    padding-bottom: 24px;
  }

  .expandable-item:not(.expanded):hover {
    background: var(--SurfaceSuperLight);
  }

  .expandable-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
  }

  .expandable-content {
    display: grid;
    grid-template-rows: 0fr;
    opacity: 0;
    transition: grid-template-rows 0.45s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    width: 100%;
  }

  .expandable-content > .expandable-inner {
    overflow: hidden;
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .expandable-content.open {
    grid-template-rows: 1fr;
    opacity: 1;
  }

  /* Redirect info text in expanded BLIK */
  .redirect-info {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 0;
  }

  /* ZEN.COM App desc — show desktop variant only on desktop */
  .zenapp-desc-mobile { display: none; }
  .zenapp-desc-desktop { display: flex; }

  .redirect-info svg {
    flex-shrink: 0;
    margin-top: 1px;
  }

  .redirect-info span {
    font-size: 13px;
    font-weight: 500;
    line-height: 18px;
    color: var(--Secondary);
  }

  /* ── Card panels (animated) ── */
  .card-panel {
    display: grid;
    grid-template-rows: 0fr;
    opacity: 0;
    transition: grid-template-rows 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 100%;
  }

  .card-panel.active {
    grid-template-rows: 1fr;
    opacity: 1;
  }

  .card-panel-inner {
    overflow: hidden;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .text-link {
    font-size: 13px;
    font-weight: 700;
    color: var(--Primary);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .text-link-small {
    font-size: 12px;
    font-weight: 600;
    color: var(--Primary);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }

  .saved-card-row {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .saved-card-row.selectable {
    cursor: pointer;
    border-radius: 8px;
    transition: background 0.15s;
    margin: -8px;
    padding: 8px;
  }

  .saved-card-row.selectable:hover {
    background: var(--SurfaceLight);
  }

  .saved-card-img {
    width: 100px;
    height: 64px;
    border-radius: 8px;
    overflow: hidden;
    flex-shrink: 0;
  }

  .saved-card-img svg {
    display: block;
    width: 100%;
    height: 100%;
  }

  .saved-card-number {
    font-size: 16px;
    font-weight: 600;
    color: var(--Primary);
    letter-spacing: 1px;
  }

  .saved-card-current {
    font-size: 14px;
    font-weight: 500;
    color: var(--Secondary);
  }

  .saved-card-status {
    font-size: 13px;
    font-weight: 500;
    color: var(--Secondary);
  }

  .saved-cards-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .enter-manual-btn {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-radius: 12px;
    border: 1px solid var(--SurfaceMedium);
    background: var(--Background);
    cursor: pointer;
    transition: background 0.15s;
    margin-top: 8px;
    margin-bottom: 4px;
  }

  .enter-manual-btn:hover {
    background: var(--SurfaceSuperLight);
  }

  .enter-manual-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .enter-manual-left span {
    font-size: 14px;
    font-weight: 700;
    color: var(--Primary);
  }

  .enter-manual-icon {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: var(--SurfaceSuperLight);
    border: 1px solid var(--SurfaceMedium);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .panel-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
  }

  .return-link {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 700;
    color: var(--Primary);
    text-decoration: none;
    transition: opacity 0.15s;
  }

  .return-link:hover {
    opacity: 0.7;
  }

  /* Small card brands chip (in C2P button) */
  .brands-chip-small {
    display: inline-flex;
    padding: 4px 8px;
    background: white;
    border-radius: 4px;
    border: 0.5px solid var(--SurfaceStrong);
    align-items: center;
    height: 22px;
  }

  /* ══════════════════════════════════════════
     TABLET RESPONSIVE (786px - 1100px)
     ══════════════════════════════════════════ */
  @media (max-width: 1100px) and (min-width: 786px) {
    .page {
      width: 100%;
      max-width: 1100px;
      /* top bar is 36px; use a tighter top padding on tablet */
      padding: calc(36px + 16px) 24px 160px;
      align-items: center;
    }

    .content {
      gap: 24px;
      width: 100%;
      max-width: 960px;
      justify-content: center;
    }

    .left-col {
      flex: 1;
      min-width: 0;
      max-width: 552px;
    }

    .right-col {
      width: 300px;
      flex-shrink: 0;
    }

    .right-col-inner {
      width: 300px;
    }

    .total-box { padding: 20px; }
    .total-amount .amount { font-size: 36px; }

    /* Tablet: ensure bottom bar is above system nav */
    .bottom-bar {
      padding-bottom: max(8px, env(safe-area-inset-bottom));
    }
  }

  /* cashcard-details-expanded: domyślnie ukryty (max-height transition), widoczny tylko w mobile przez .visible */
  .cashcard-details-expanded {
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    transition: max-height 0.35s ease, opacity 0.25s ease;
    padding: 0;
  }

  /* cashcard-details-row: domyślnie ukryty, pokazywany w mobile */
  .cashcard-details-row {
    display: none;
  }

  /* ══════════════════════════════════════════
     MOBILE RESPONSIVE (≤785px)
     ══════════════════════════════════════════ */
  @media (max-width: 785px) {
    .page {
      width: 100%;
      padding: 0;
      gap: 0;
    }

    .content {
      flex-direction: column;
      gap: 0;
      width: 100%;
      padding-bottom: 240px;
    }

    /* ── Left col ── */
    .left-col {
      width: 100%;
      gap: 16px;
      padding: 0 20px;
      align-items: stretch;
    }

    /* Hide desktop header */
    .header-row { display: none; }

    /* Mobile header: merchant + badge */
    .mobile-header {
      display: flex !important;
      align-items: flex-start;
      justify-content: space-between;
      padding: 16px 20px;
      padding-top: calc(36px + 16px);
      width: 100%;
      background: #FFFFFF;
    }

    .mobile-header .merchant-logo {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      flex-shrink: 0;
    }

    .mobile-header .mobile-header-left {
      display: flex !important;
      flex-direction: row !important;
      align-items: center;
      gap: 10px;
    }

    .mobile-header .merchant-logo img {
      width: 44px;
      height: 44px;
      border-radius: 12px;
    }

    .mobile-header .merchant-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .mobile-header .merchant-label {
      font-size: 10px;
      color: var(--Secondary);
    }

    .mobile-header .merchant-name {
      font-size: 16px;
      font-weight: 700;
    }

    .mobile-header .lang-toggle {
      font-size: 14px;
      font-weight: 700;
    }

    /* Badge "Processed by ZEN.COM" w nagłówku mobilnym */
    .mobile-header-badge {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-top: 3px;
    }

    .mobile-header-badge-text {
      font-size: 11px;
      font-weight: 500;
      color: var(--Tertiary);
      white-space: nowrap;
    }

    .mobile-header-badge-logo {
      height: 16px;
      width: auto;
      flex-shrink: 0;
    }

    /* Aurora na mobile badge */
    @keyframes mobile-badge-glow {
      0%   { filter: none; }
      20%  { filter: sepia(1) saturate(4) hue-rotate(85deg) brightness(1.2)
             drop-shadow(0 0 3px rgba(34,226,67,0.30))
             drop-shadow(0 0 8px rgba(34,226,67,0.15))
             drop-shadow(0 0 18px rgba(34,226,67,0.06))
             drop-shadow(0 0 35px rgba(34,226,67,0.03)); }
      45%  { filter: sepia(1) saturate(5) hue-rotate(85deg) brightness(1.35)
             drop-shadow(0 0 4px rgba(34,226,67,0.60))
             drop-shadow(0 0 12px rgba(34,226,67,0.30))
             drop-shadow(0 0 28px rgba(34,226,67,0.15))
             drop-shadow(0 0 55px rgba(34,226,67,0.06))
             drop-shadow(0 0 80px rgba(34,226,67,0.03)); }
      70%  { filter: sepia(1) saturate(3) hue-rotate(85deg) brightness(1.15)
             drop-shadow(0 0 3px rgba(34,226,67,0.15))
             drop-shadow(0 0 10px rgba(34,226,67,0.06)); }
      100% { filter: none; }
    }

    .mobile-header-badge.shimmer .mobile-header-badge-logo {
      animation: mobile-badge-glow 1.0s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    /* Mobile title: "Payment method for Poland ˅" + EN */
    .mobile-title {
      display: flex !important;
      align-items: center;
      justify-content: space-between;
      font-size: 16px;
      font-weight: 700;
      padding: 12px 0 12px;
      line-height: 1.3;
      text-align: left;
    }

    .mobile-title-left {
      display: flex;
      align-items: center;
      gap: 2px;
    }

    .mobile-title .underlined-country {
      text-decoration: underline;
      text-decoration-color: var(--Primary);
      text-underline-offset: 4px;
      text-decoration-thickness: 1px;
    }

    .mobile-title-lang {
      font-size: 14px;
      font-weight: 700;
      color: var(--Primary);
      flex-shrink: 0;
    }

    /* Payment card */
    .payment-card {
      border-radius: 16px;
    }

    .payment-card > *:first-child { border-radius: 16px 16px 0 0; }
    .payment-card > *:last-child { border-radius: 0 0 16px 16px; }

    .payment-item { padding: 16px; flex-wrap: wrap; }
    .expandable-item { padding: 16px; }
    .expandable-item.expanded { border-radius: 16px; padding-bottom: 16px; }

    /* On mobile, payment-item-left takes full width so brands/chips go below */
    .payment-item .payment-item-left {
      width: 100%;
      align-items: center;
    }
    /* Hide desktop-positioned bank logos on mobile */
    .payment-item > .bank-logos {
      display: none !important;
    }
    /* Show mobile bank logos inside pm-info */
    .bank-logos-mobile {
      display: flex !important;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
      width: fit-content;
    }

    /* Also for expandable items (Card) - brands below text */
    .expandable-header {
      flex-wrap: wrap;
      align-items: center;
    }
    .expandable-header .payment-item-left {
      width: 100%;
      align-items: center;
    }
    /* Hide the sibling brands-inline on mobile; we show the one inside pm-info instead */
    .expandable-header > .card-brands-inline {
      display: none !important;
    }
    .card-brands-mobile {
      display: inline-flex !important;
      align-items: center;
      margin-top: 4px;
      width: fit-content;
      padding: 4px 8px;
      border: 0.5px solid var(--SurfaceStrong);
      border-radius: 4px;
      background: white;
    }

    .pm-icon { width: 48px; height: 48px; border-radius: 12px; }
    .pm-name { font-size: 16px; }
    .pm-desc { font-size: 13px; }

    .app-only-mobile { display: inline-flex !important; margin-top: 4px; padding: 3px 6px; width: auto; align-self: flex-start; }
    .app-only-mobile span { font-size: 10px; line-height: 14px; }
    .app-only-mobile svg { width: 10px; height: 10px; }
    .app-only-desktop { display: none !important; }

    /* Prevent card brands from stretching in flex column */

    .show-all { padding: 14px 16px; font-size: 13px; }

    /* === MOBILE: show all payment methods without toggle === */
    .extra-methods { grid-template-rows: 1fr !important; }
    .show-all { display: none !important; }

    /* Fix: bottom border-radius on last item inside extra-methods */
    .extra-methods-inner > .payment-item:last-child {
      border-radius: 0 0 16px 16px;
    }

    /* Fix: align expandable-item icons with payment-item icons (compensate 3px border) */
    .expandable-item { padding-left: 13px; }
    .expandable-item.expanded { padding-left: 13px; }

    /* ZEN.COM App desc — swap on mobile */
    .zenapp-desc-desktop { display: none; }
    .zenapp-desc-mobile { display: flex; }

    .trust-row {
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px 16px;
      padding: 20px 0;
    }

    .payment-secured {
      display: none;
    }

    /* ── Right col → fixed mobile bottom bar ── */
    .right-col {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      width: 100% !important;
      z-index: 200;
      background: white;
      border-top: 1px solid var(--SurfaceMedium);
      box-shadow: 0 -2px 16px rgba(0,0,0,0.08);
      padding: 16px 20px calc(max(12px, env(safe-area-inset-bottom)));
      gap: 10px;
      top: auto;
      align-self: auto;
    }

    .merchant-section { gap: 10px; }
    .merchant-header { display: none; }

    /* Desktop currency tabs hidden on mobile */
    .currency-tabs { display: none !important; }

    /* Mobile total box — no background/border */
    .total-box {
      padding: 0;
      background: transparent;
      border: none;
      border-radius: 0;
    }

    .total-label { display: none; } /* hide "TOTAL TO PAY" label on mobile */

    .total-top-row {
      flex-direction: row !important;
      align-items: flex-end;
      gap: 4px;
    }

    .total-amount .amount {
      font-size: 32px;
      line-height: 36px;
      font-weight: 700;
    }

    .total-amount .currency {
      font-size: 14px;
      padding-bottom: 3px;
    }

    /* Mobile currency dropdown hint (shown after method selected via JS) */
    .mobile-currency-chevron {
      display: none !important;
      margin-left: 2px;
      align-self: flex-end;
      padding-bottom: 5px;
    }

    .mobile-currency-chevron.visible {
      display: flex !important;
    }

    /* Underline on currency when method selected */
    .total-amount.has-dropdown .currency {
      text-decoration: underline;
      text-underline-offset: 3px;
      text-decoration-thickness: 1px;
      cursor: pointer;
    }

    .exchange-rate-row {
      margin-top: 2px;
      padding-top: 0;
      border-top: none;
      font-size: 11px;
    }

    /* Continue section */
    .continue-section {
      gap: 8px;
      width: 100%;
    }

    .static-btn-row { width: 100%; }
    .static-btn {
      height: 60px;
      font-size: 16px;
      border-radius: 100px;
    }

    /* Canvas stepper fills mobile width */
    #stepperWrap {
      width: 100% !important;
      height: 60px !important;
    }

    #stepperCanvas {
      width: 100% !important;
      height: 60px !important;
    }

    .terms-text {
      font-size: 10px;
      color: #727272;
      text-align: center;
      line-height: 1.4;
      min-height: 0;
      margin-top: 6px;
    }

    /* ── Mobile: Card detail view ── */
    body.mobile-card-view .mobile-header,
    body.mobile-card-view .mobile-title,
    body.mobile-card-view .trust-row,
    body.mobile-card-view #blikItem,
    body.mobile-card-view #sep-blik-card,
    body.mobile-card-view #sep-card-apple,
    body.mobile-card-view #showAllBtn,
    body.mobile-card-view .extra-methods,
    body.mobile-card-view #zenappItem,
    body.mobile-card-view #sep-bank-zenapp,
    body.mobile-card-view #sep-zenapp-bank {
      display: none !important;
    }

    /* Hide all non-expandable items in card view */
    body.mobile-card-view .payment-card > .payment-item,
    body.mobile-card-view .payment-card > .payment-separator {
      display: none !important;
    }

    body.mobile-card-view .payment-card {
      border: none;
      box-shadow: none;
    }

    body.mobile-card-view .left-col {
      padding-top: 0;
    }

    /* Hide "Return to saved cards" only in saved panel on mobile — back arrow replaces it */
    body.mobile-card-view #panelSaved .return-link {
      display: none;
    }

    /* Hide card expandable-item header on mobile (replaced by mobile-card-header) */
    body.mobile-card-view #cardItem .expandable-header {
      display: none !important;
    }

    /* Card expanded content in mobile view */
    body.mobile-card-view #cardItem.expanded {
      border: none;
      box-shadow: none;
      padding: 0;
      gap: 0;
    }

    /* Prevent expandable-content from stretching taller than its content on mobile */
    body.mobile-card-view #cardItem .expandable-content.open {
      align-items: start;
    }

    /* Keep card-panel-inner border visible */
    body.mobile-card-view .card-panel-inner {
      border: 2px solid var(--Primary);
      border-radius: 16px;
      padding: 20px;
    }

    body.mobile-card-view #panelSaved .panel-footer {
      justify-content: center;
    }
    body.mobile-card-view .expandable-item.expanded {
      padding-bottom: 20px;
    }

    .mobile-card-header {
      display: none;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      padding-top: calc(36px + 16px);
      width: 100%;
      background: #FFFFFF;
    }

    body.mobile-card-view .mobile-card-header {
      display: flex !important;
    }

    .mobile-back-arrow {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      cursor: pointer;
      flex-shrink: 0;
      margin-left: -4px;
    }

    .mobile-card-header .pm-icon {
      width: 44px;
      height: 44px;
    }

    .mobile-card-header .pm-info .pm-name {
      font-size: 18px;
      font-weight: 700;
    }

    .mobile-card-header .pm-info .pm-desc {
      font-size: 13px;
      color: var(--Secondary);
    }

    /* Panel footer layout on mobile card view */

    .save-card-sub {
      flex-wrap: wrap;
      gap: 4px 6px;
    }

    .save-card-section {
      gap: 6px;
    }

    /* Desktop bottom bar hidden on mobile */
    .bottom-bar {
      display: none !important;
    }

    /* Mobile steps info line (legacy - hidden) */
    .mobile-steps {
      display: none !important;
    }

    /* CashCard details row — widoczny na mobile po wybraniu metody */
    .cashcard-details-row {
      align-items: center;
      justify-content: space-between;
      width: 100%;
      font-size: 11px;
      color: var(--Secondary);
      line-height: 1.4;
      padding-top: 4px;
    }

    .cashcard-details-row.visible {
      display: flex !important;
    }

    .cashcard-details-left {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      flex: 1;
    }

    .cashcard-details-text {
      font-size: 11px;
      color: var(--Secondary);
      line-height: 1.4;
      padding-top: 0;
    }

    .cashcard-details-text a {
      color: var(--Primary);
      font-weight: 700;
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    .cashcard-details-toggle {
      display: flex;
      align-items: center;
      gap: 3px;
      font-size: 11px;
      font-weight: 600;
      color: var(--Primary);
      cursor: pointer;
      flex-shrink: 0;
      user-select: none;
    }

    .cashcard-details-toggle svg {
      transition: transform 0.25s ease;
    }

    .cashcard-details-toggle.open svg {
      transform: rotate(180deg);
    }

    /* Expanded details panel — widoczny na mobile po kliknięciu */
    .cashcard-details-expanded.visible {
      max-height: 300px;
      opacity: 1;
    }

    /* Kroki wewnątrz details */
    .cashcard-steps {
      display: flex;
      flex-direction: column;
      gap: 0;
      padding: 0;
    }

    .cashcard-step {
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    /* Krok bez własnej kropki (step 1 — kropka jest w wierszu wyżej) */
    .cashcard-step--text-only .cashcard-step-indicator {
      padding-top: 0;
    }

    .cashcard-step--text-only .cashcard-step-line {
      margin-top: 0;
    }

    .cashcard-step-indicator {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex-shrink: 0;
      width: 12px;
      align-self: stretch;
      padding-top: 2px;
    }

    .cashcard-step-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: transparent;
      border: 1.5px solid #C8C8C8;
      flex-shrink: 0;
      box-sizing: border-box;
    }

    .cashcard-step-dot.active {
      background: #222;
      border-color: #222;
    }

    .cashcard-step-line {
      width: 1.5px;
      flex: 1;
      min-height: 6px;
      background: #E4E4E4;
      margin: 3px 0 0 0;
    }

    .cashcard-step-text {
      font-size: 11px;
      color: var(--Secondary);
      line-height: 1.5;
      padding-bottom: 12px;
    }

    .cashcard-step-text.active {
      color: #222;
      font-weight: 600;
    }

    .cashcard-step-text a {
      color: var(--Primary);
      font-weight: 700;
      text-decoration: underline;
    }

    .cashcard-step:last-child .cashcard-step-line {
      display: none;
    }

    .cashcard-step:last-child .cashcard-step-text {
      padding-bottom: 0;
    }

    .mobile-steps a {
      color: var(--Primary);
      font-weight: 700;
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    /* ── Mobile: Expiry + CVV fields fit in row ── */
    .field-row {
      gap: 12px;
    }
    .field {
      min-width: 0;
    }
    .field input {
      min-width: 0;
      width: 100%;
    }
  }

  /* Elements hidden on desktop, shown on mobile */
  .mobile-header { display: none; }
  .mobile-title { display: none; }
  .mobile-steps { display: none; }
  .mobile-currency-chevron { display: none; }
  .mobile-card-header { display: none; }
  /* cashcard-details-expanded: ukryty na desktop (max-height:0 jest ustawiony globalnie) */
  .mobile-header-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }
</style>
</head>
<body>

<!-- ── Sticky top bar ── -->
<div id="topBar" style="
  position:fixed;top:0;left:0;right:0;z-index:999;
  background:rgba(255,255,255,0.92);
  backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
  border-bottom:1px solid #EBEBEB;
  padding:0 20px;
  height:36px;
  display:flex;align-items:center;justify-content:space-between;
  font-family:'Nunito',sans-serif;
">
  <span onclick="window.parent.postMessage({type:'navigate',to:'/checkout'},'*')" style="font-size:10px;font-weight:700;color:#A3A3A3;letter-spacing:0.3px;line-height:1;display:flex;align-items:center;cursor:pointer;">ZEN.COM Pay 2.0 Checkout</span>
  <div style="position:relative;display:flex;align-items:center;">
    <button id="authorBtn" onclick="toggleAuthorCard()" style="
      background:none;border:none;cursor:pointer;padding:0;
      font-family:'Nunito',sans-serif;font-size:10px;font-weight:600;color:#A3A3A3;
      letter-spacing:0.3px;text-decoration:underline;text-underline-offset:2px;
      transition:color 0.15s;line-height:1;display:flex;align-items:center;
    " onmouseenter="this.style.color='#222'" onmouseleave="this.style.color='#A3A3A3'">Designed and Built by Mateusz Karbowski</button>
    <div id="authorCard" style="
      position:absolute;right:0;top:calc(100% + 8px);
      background:#fff;border:1px solid #EBEBEB;border-radius:16px;
      box-shadow:0 8px 32px rgba(0,0,0,0.10);
      padding:16px 18px;width:240px;
      display:flex;flex-direction:column;align-items:center;gap:10px;
      opacity:0;transform:translateY(-8px) scale(0.97);pointer-events:none;
      transition:opacity 0.22s cubic-bezier(0.4,0,0.2,1),transform 0.22s cubic-bezier(0.4,0,0.2,1);
    ">
      <img src="./mateusz-karbowski.jpg" alt="Mateusz Karbowski" style="
        width:56px;height:56px;border-radius:50%;object-fit:cover;
        border:2px solid #EBEBEB;
      ">
      <p style="font-size:11px;font-weight:500;color:#727272;text-align:center;line-height:16px;margin:0;">
        If you have any questions or suggestions, feel free to reach out at<br>
        <a href="mailto:mateusz.karbowski@zen.com" style="color:#222;font-weight:700;text-decoration:underline;text-underline-offset:2px;">mateusz.karbowski@zen.com</a>
      </p>
    </div>
  </div>
</div>
<script>
function toggleAuthorCard(){
  const c=document.getElementById('authorCard');
  const isOpen=c.style.opacity==='1';
  if(isOpen){
    c.style.opacity='0';c.style.transform='translateY(-8px) scale(0.97)';c.style.pointerEvents='none';
  } else {
    c.style.opacity='1';c.style.transform='translateY(0) scale(1)';c.style.pointerEvents='auto';
  }
}
document.addEventListener('click',function(e){
  if(!document.getElementById('authorBtn').contains(e.target)&&!document.getElementById('authorCard').contains(e.target)){
    const c=document.getElementById('authorCard');
    c.style.opacity='0';c.style.transform='translateY(-8px) scale(0.97)';c.style.pointerEvents='none';
  }
});
</script>

<div class="mobile-card-header" id="mobileCardHeader">
  <div class="mobile-back-arrow" onclick="mobileBackToList()">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="#222" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </div>
  <div class="pm-icon" style="width:44px;height:44px;border-radius:10px;">
    <svg width="20" height="14" viewBox="0 0 20 14" fill="none"><rect x="1" y="1" width="18" height="12" rx="2" stroke="#222" stroke-width="1.4" fill="none"/><path d="M1 5h18" stroke="#222" stroke-width="1.4"/></svg>
  </div>
  <div class="pm-info" style="flex:1;">
    <div class="pm-name">Card</div>
    <div class="pm-desc">Debit or credit</div>
  </div>
  <div class="card-brands-inline"><svg width="84" height="14" viewBox="0 0 83.2222 14" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip_mch1)"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5969 0.971788C14.8472 0.730697 15.2441 0.732467 15.4923 0.975778L19.9895 6.43758C20.3032 6.74509 20.3001 7.25082 19.9826 7.55445L15.571 13.0598C15.4624 13.1638 15.3177 13.2218 15.1672 13.2218H11.463C10.941 13.2218 10.6812 12.5897 11.0528 12.2233L15.5731 6.99957L11.463 1.94401H9.81431L13.7451 6.43782C14.0659 6.74393 14.0661 7.25549 13.7457 7.56195L8.58099 13.0598C8.47226 13.1638 8.32759 13.2218 8.17709 13.2218H2.33327C1.04493 13.2218 0.000381238 12.1776 0.000183275 10.8893C-0.000215146 8.29635 0.000123868 5.70348 0.000372411 3.11057C0.000495932 1.82195 1.04515 0.777344 2.33378 0.777344H4.65491C4.97742 0.777344 5.23888 1.03851 5.23888 1.36068C5.23888 1.68284 4.97742 1.94401 4.65491 1.94401H2.72402C1.86491 1.94401 1.16846 2.64046 1.16846 3.49957C1.16846 5.8329 1.16846 8.16623 1.16846 10.4996C1.16846 11.3587 1.86491 12.0551 2.72402 12.0551H7.74494L12.4586 6.99957L7.93831 1.77584C7.56674 1.40947 7.82647 0.777344 8.34851 0.777344H11.9589C12.1094 0.777344 12.254 0.835382 12.3627 0.939347L16.8602 6.43718C17.1806 6.74365 17.1803 7.2552 16.8597 7.56132L12.9288 12.0551H14.6811L18.6877 6.99957L14.5969 1.94401C14.3405 1.69068 14.3372 1.2218 14.5969 0.971788Z" fill="#141413"/><path d="M25.6684 1.16623C25.6684 0.951455 25.4943 0.777344 25.2795 0.777344C25.0647 0.777344 24.8906 0.951455 24.8906 1.16623V12.8329C24.8906 13.0477 25.0647 13.2218 25.2795 13.2218C25.4943 13.2218 25.6684 13.0477 25.6684 12.8329V1.16623Z" fill="#141413"/><path d="M43.9589 1.80273H37.7109V12.1966H43.9589V1.80273Z" fill="#FF5F00"/><path d="M38.3548 6.99954C38.3533 4.97164 39.2673 3.05562 40.8335 1.80356C38.1728 -0.326235 34.3518 -0.0160118 32.0559 2.51621C29.76 5.04843 29.76 8.95246 32.0559 11.4847C34.3518 14.017 38.1728 14.3271 40.8335 12.1973C39.2668 10.9449 38.3527 9.02806 38.3548 6.99954Z" fill="#EB001B"/><path d="M50.5939 11.1695V10.9472H50.6833V10.9102H50.4688V10.9472H50.5581V11.1695H50.5939Z" fill="#F79E1B"/><path d="M51.0047 10.9102H50.9333L50.8618 11.0954L50.7903 10.9102H50.7188V11.1695H50.7724V10.9657L50.8318 11.1324H50.8976L50.955 10.9657V11.1695H51.0047V10.9102Z" fill="#F79E1B"/><path d="M51.3325 7.00014C51.3325 9.53083 49.9137 11.8393 47.6788 12.9452C45.4439 14.0511 42.7853 13.7602 40.832 12.1961C42.3975 10.943 43.3117 9.02722 43.3117 6.99922C43.3117 4.97121 42.3975 3.05545 40.832 1.80232C42.7853 0.238221 45.4439 -0.0526519 47.6788 1.05324C49.9137 2.15913 51.3325 4.46763 51.3325 6.99831V7.00014Z" fill="#F79E1B"/><path fill-rule="evenodd" clip-rule="evenodd" d="M75.4472 8.44718C75.4525 7.13999 74.3398 6.57195 73.45 6.11759C72.8527 5.81264 72.3557 5.55891 72.3644 5.16727C72.3707 4.87044 72.6618 4.5552 73.297 4.47424C73.6121 4.43377 74.4805 4.4031 75.4661 4.84468L75.8517 3.08941C75.3223 2.90174 74.6418 2.72266 73.7935 2.72266C71.6195 2.72266 70.0894 3.84745 70.0755 5.45921C70.0617 6.65024 71.1682 7.31506 72.0014 7.71125C72.8584 8.11725 73.1457 8.37733 73.142 8.73916C73.1369 9.2948 72.4589 9.53887 71.8261 9.54867C70.7537 9.56531 70.1181 9.27676 69.6142 9.04786L69.5664 9.02616L69.1681 10.8391C69.6823 11.0684 70.6301 11.2684 71.6144 11.2782C73.9284 11.2782 75.4395 10.1669 75.4472 8.44718ZM66.3361 2.87354L62.7718 11.1494H60.4465L58.6934 4.54417C58.5862 4.13694 58.4942 3.98851 58.1703 3.8168C57.6422 3.53713 56.7688 3.27586 56 3.11272L56.0529 2.87231H59.7962C60.2726 2.87231 60.7024 3.18141 60.8107 3.71621L61.737 8.50606L64.0259 2.87354H66.3361ZM83.2222 11.1496H81.1883L80.9231 9.91313H78.1013L77.6427 11.1496H75.3324L78.6318 3.48085C78.7904 3.11287 79.1459 2.87369 79.5682 2.87369H81.4466L83.2222 11.1496ZM78.7344 8.21657L79.8926 5.10836L80.5591 8.21657H78.7344ZM67.6607 11.1496L69.4794 2.87369H67.2814L65.4614 11.1496H67.6607Z" fill="#1A1F71"/></g><defs><clipPath id="clip_mch1"><rect width="83.2222" height="14" fill="white"/></clipPath></defs></svg></div>
</div>

<div class="mobile-header">
  <div class="mobile-header-left">
    <div class="merchant-logo">
      <img src="./icons/super-merchant-logo.svg" alt="merchant" style="display:block;width:44px;height:44px;border-radius:12px;">
    </div>
    <div class="merchant-info">
      <div class="merchant-label">Payment for:</div>
      <div class="merchant-name">super-merchant.com</div>
    </div>
  </div>
  <div class="mobile-header-badge" id="mobileHeaderBadge">
    <span class="mobile-header-badge-text">Processed by</span>
    <img src="./icons/zencom-logo.svg" alt="ZEN.COM" class="mobile-header-badge-logo">
  </div>
</div>

<div class="page">
  <div class="content">

    <!-- ════════ LEFT COLUMN ════════ -->
    <div class="left-col">

      <div class="mobile-title">
        <div class="mobile-title-left">Payment method for <span class="underlined-country">Poland</span><svg width="14" height="14" viewBox="0 0 14 14" fill="none" style="margin-left:4px;vertical-align:middle;flex-shrink:0"><path d="M4 5.5L7 8.5L10 5.5" stroke="#222" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
        <div class="mobile-title-lang lang-toggle">EN</div>
      </div>

      <div class="header-row">
        <div>
          <div class="header-title">Select payment method</div>
          <div class="header-subtitle">12 methods available</div>
        </div>
        <div class="country-selector">
          <div class="country-label">Country</div>
          <div class="country-value-row">
            <span class="country-value">Poland</span>
            <div class="country-chevron">
              <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M3 4.5L6 7.5L9 4.5" stroke="#222" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
          </div>
          <div class="country-underline"></div>
        </div>
      </div>

      <div class="payment-card">

        <!-- BLIK (expandable) -->
        <div class="expandable-item" id="blikItem" onclick="expandItem('blik')">
          <div class="expandable-header">
            <div class="payment-item-left">
              <div class="pm-icon" style="overflow:hidden;padding:0;">
                <img src="./icons/Blik3.svg" alt="BLIK" style="width:40px;height:40px;border-radius:12px;display:block;">
              </div>
              <div class="pm-info">
                <div class="pm-name">BLIK</div>
                <div class="pm-desc">Use code from you bank app</div>
              </div>
            </div>
          </div>
          <div class="expandable-content" id="blikExpanded">
            <div class="expandable-inner">
              <div class="redirect-info">
                <img src="./icons/after-confirming.svg" alt="" style="width:16px;height:16px;flex-shrink:0;">
                <span>After clicking Pay, you'll be redirected to the next step to securely provide your payment details.</span>
              </div>
            </div>
          </div>
        </div>
        <hr class="payment-separator" id="sep-blik-card">

        <!-- CARD (expandable) -->
        <div class="expandable-item" id="cardItem" onclick="expandItem('card')">
          <div class="expandable-header">
            <div class="payment-item-left" id="cardHeader">
              <div class="pm-icon" style="overflow:hidden;padding:0;">
                <img src="./icons/card.svg" alt="Card" style="width:40px;height:40px;border-radius:12px;display:block;">
              </div>
              <div class="pm-info">
                <div class="pm-name">Card</div>
                <div class="pm-desc">Debit or credit</div>
                <div class="card-brands-mobile"><svg width="84" height="14" viewBox="0 0 83.2222 14" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip_cbm1)"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5969 0.971788C14.8472 0.730697 15.2441 0.732467 15.4923 0.975778L19.9895 6.43758C20.3032 6.74509 20.3001 7.25082 19.9826 7.55445L15.571 13.0598C15.4624 13.1638 15.3177 13.2218 15.1672 13.2218H11.463C10.941 13.2218 10.6812 12.5897 11.0528 12.2233L15.5731 6.99957L11.463 1.94401H9.81431L13.7451 6.43782C14.0659 6.74393 14.0661 7.25549 13.7457 7.56195L8.58099 13.0598C8.47226 13.1638 8.32759 13.2218 8.17709 13.2218H2.33327C1.04493 13.2218 0.000381238 12.1776 0.000183275 10.8893C-0.000215146 8.29635 0.000123868 5.70348 0.000372411 3.11057C0.000495932 1.82195 1.04515 0.777344 2.33378 0.777344H4.65491C4.97742 0.777344 5.23888 1.03851 5.23888 1.36068C5.23888 1.68284 4.97742 1.94401 4.65491 1.94401H2.72402C1.86491 1.94401 1.16846 2.64046 1.16846 3.49957C1.16846 5.8329 1.16846 8.16623 1.16846 10.4996C1.16846 11.3587 1.86491 12.0551 2.72402 12.0551H7.74494L12.4586 6.99957L7.93831 1.77584C7.56674 1.40947 7.82647 0.777344 8.34851 0.777344H11.9589C12.1094 0.777344 12.254 0.835382 12.3627 0.939347L16.8602 6.43718C17.1806 6.74365 17.1803 7.2552 16.8597 7.56132L12.9288 12.0551H14.6811L18.6877 6.99957L14.5969 1.94401C14.3405 1.69068 14.3372 1.2218 14.5969 0.971788Z" fill="#141413"/><path d="M25.6684 1.16623C25.6684 0.951455 25.4943 0.777344 25.2795 0.777344C25.0647 0.777344 24.8906 0.951455 24.8906 1.16623V12.8329C24.8906 13.0477 25.0647 13.2218 25.2795 13.2218C25.4943 13.2218 25.6684 13.0477 25.6684 12.8329V1.16623Z" fill="#141413"/><path d="M43.9589 1.80273H37.7109V12.1966H43.9589V1.80273Z" fill="#FF5F00"/><path d="M38.3548 6.99954C38.3533 4.97164 39.2673 3.05562 40.8335 1.80356C38.1728 -0.326235 34.3518 -0.0160118 32.0559 2.51621C29.76 5.04843 29.76 8.95246 32.0559 11.4847C34.3518 14.017 38.1728 14.3271 40.8335 12.1973C39.2668 10.9449 38.3527 9.02806 38.3548 6.99954Z" fill="#EB001B"/><path d="M50.5939 11.1695V10.9472H50.6833V10.9102H50.4688V10.9472H50.5581V11.1695H50.5939Z" fill="#F79E1B"/><path d="M51.0047 10.9102H50.9333L50.8618 11.0954L50.7903 10.9102H50.7188V11.1695H50.7724V10.9657L50.8318 11.1324H50.8976L50.955 10.9657V11.1695H51.0047V10.9102Z" fill="#F79E1B"/><path d="M51.3325 7.00014C51.3325 9.53083 49.9137 11.8393 47.6788 12.9452C45.4439 14.0511 42.7853 13.7602 40.832 12.1961C42.3975 10.943 43.3117 9.02722 43.3117 6.99922C43.3117 4.97121 42.3975 3.05545 40.832 1.80232C42.7853 0.238221 45.4439 -0.0526519 47.6788 1.05324C49.9137 2.15913 51.3325 4.46763 51.3325 6.99831V7.00014Z" fill="#F79E1B"/><path fill-rule="evenodd" clip-rule="evenodd" d="M75.4472 8.44718C75.4525 7.13999 74.3398 6.57195 73.45 6.11759C72.8527 5.81264 72.3557 5.55891 72.3644 5.16727C72.3707 4.87044 72.6618 4.5552 73.297 4.47424C73.6121 4.43377 74.4805 4.4031 75.4661 4.84468L75.8517 3.08941C75.3223 2.90174 74.6418 2.72266 73.7935 2.72266C71.6195 2.72266 70.0894 3.84745 70.0755 5.45921C70.0617 6.65024 71.1682 7.31506 72.0014 7.71125C72.8584 8.11725 73.1457 8.37733 73.142 8.73916C73.1369 9.2948 72.4589 9.53887 71.8261 9.54867C70.7537 9.56531 70.1181 9.27676 69.6142 9.04786L69.5664 9.02616L69.1681 10.8391C69.6823 11.0684 70.6301 11.2684 71.6144 11.2782C73.9284 11.2782 75.4395 10.1669 75.4472 8.44718ZM66.3361 2.87354L62.7718 11.1494H60.4465L58.6934 4.54417C58.5862 4.13694 58.4942 3.98851 58.1703 3.8168C57.6422 3.53713 56.7688 3.27586 56 3.11272L56.0529 2.87231H59.7962C60.2726 2.87231 60.7024 3.18141 60.8107 3.71621L61.737 8.50606L64.0259 2.87354H66.3361ZM83.2222 11.1496H81.1883L80.9231 9.91313H78.1013L77.6427 11.1496H75.3324L78.6318 3.48085C78.7904 3.11287 79.1459 2.87369 79.5682 2.87369H81.4466L83.2222 11.1496ZM78.7344 8.21657L79.8926 5.10836L80.5591 8.21657H78.7344ZM67.6607 11.1496L69.4794 2.87369H67.2814L65.4614 11.1496H67.6607Z" fill="#1A1F71"/></g><defs><clipPath id="clip_cbm1"><rect width="83.2222" height="14" fill="white"/></clipPath></defs></svg></div>
              </div>
            </div>
            <div id="cardBrandsCollapsed" class="card-brands-inline">
              <svg width="84" height="14" viewBox="0 0 83.2222 14" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip_cbd1)"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5969 0.971788C14.8472 0.730697 15.2441 0.732467 15.4923 0.975778L19.9895 6.43758C20.3032 6.74509 20.3001 7.25082 19.9826 7.55445L15.571 13.0598C15.4624 13.1638 15.3177 13.2218 15.1672 13.2218H11.463C10.941 13.2218 10.6812 12.5897 11.0528 12.2233L15.5731 6.99957L11.463 1.94401H9.81431L13.7451 6.43782C14.0659 6.74393 14.0661 7.25549 13.7457 7.56195L8.58099 13.0598C8.47226 13.1638 8.32759 13.2218 8.17709 13.2218H2.33327C1.04493 13.2218 0.000381238 12.1776 0.000183275 10.8893C-0.000215146 8.29635 0.000123868 5.70348 0.000372411 3.11057C0.000495932 1.82195 1.04515 0.777344 2.33378 0.777344H4.65491C4.97742 0.777344 5.23888 1.03851 5.23888 1.36068C5.23888 1.68284 4.97742 1.94401 4.65491 1.94401H2.72402C1.86491 1.94401 1.16846 2.64046 1.16846 3.49957C1.16846 5.8329 1.16846 8.16623 1.16846 10.4996C1.16846 11.3587 1.86491 12.0551 2.72402 12.0551H7.74494L12.4586 6.99957L7.93831 1.77584C7.56674 1.40947 7.82647 0.777344 8.34851 0.777344H11.9589C12.1094 0.777344 12.254 0.835382 12.3627 0.939347L16.8602 6.43718C17.1806 6.74365 17.1803 7.2552 16.8597 7.56132L12.9288 12.0551H14.6811L18.6877 6.99957L14.5969 1.94401C14.3405 1.69068 14.3372 1.2218 14.5969 0.971788Z" fill="#141413"/><path d="M25.6684 1.16623C25.6684 0.951455 25.4943 0.777344 25.2795 0.777344C25.0647 0.777344 24.8906 0.951455 24.8906 1.16623V12.8329C24.8906 13.0477 25.0647 13.2218 25.2795 13.2218C25.4943 13.2218 25.6684 13.0477 25.6684 12.8329V1.16623Z" fill="#141413"/><path d="M43.9589 1.80273H37.7109V12.1966H43.9589V1.80273Z" fill="#FF5F00"/><path d="M38.3548 6.99954C38.3533 4.97164 39.2673 3.05562 40.8335 1.80356C38.1728 -0.326235 34.3518 -0.0160118 32.0559 2.51621C29.76 5.04843 29.76 8.95246 32.0559 11.4847C34.3518 14.017 38.1728 14.3271 40.8335 12.1973C39.2668 10.9449 38.3527 9.02806 38.3548 6.99954Z" fill="#EB001B"/><path d="M50.5939 11.1695V10.9472H50.6833V10.9102H50.4688V10.9472H50.5581V11.1695H50.5939Z" fill="#F79E1B"/><path d="M51.0047 10.9102H50.9333L50.8618 11.0954L50.7903 10.9102H50.7188V11.1695H50.7724V10.9657L50.8318 11.1324H50.8976L50.955 10.9657V11.1695H51.0047V10.9102Z" fill="#F79E1B"/><path d="M51.3325 7.00014C51.3325 9.53083 49.9137 11.8393 47.6788 12.9452C45.4439 14.0511 42.7853 13.7602 40.832 12.1961C42.3975 10.943 43.3117 9.02722 43.3117 6.99922C43.3117 4.97121 42.3975 3.05545 40.832 1.80232C42.7853 0.238221 45.4439 -0.0526519 47.6788 1.05324C49.9137 2.15913 51.3325 4.46763 51.3325 6.99831V7.00014Z" fill="#F79E1B"/><path fill-rule="evenodd" clip-rule="evenodd" d="M75.4472 8.44718C75.4525 7.13999 74.3398 6.57195 73.45 6.11759C72.8527 5.81264 72.3557 5.55891 72.3644 5.16727C72.3707 4.87044 72.6618 4.5552 73.297 4.47424C73.6121 4.43377 74.4805 4.4031 75.4661 4.84468L75.8517 3.08941C75.3223 2.90174 74.6418 2.72266 73.7935 2.72266C71.6195 2.72266 70.0894 3.84745 70.0755 5.45921C70.0617 6.65024 71.1682 7.31506 72.0014 7.71125C72.8584 8.11725 73.1457 8.37733 73.142 8.73916C73.1369 9.2948 72.4589 9.53887 71.8261 9.54867C70.7537 9.56531 70.1181 9.27676 69.6142 9.04786L69.5664 9.02616L69.1681 10.8391C69.6823 11.0684 70.6301 11.2684 71.6144 11.2782C73.9284 11.2782 75.4395 10.1669 75.4472 8.44718ZM66.3361 2.87354L62.7718 11.1494H60.4465L58.6934 4.54417C58.5862 4.13694 58.4942 3.98851 58.1703 3.8168C57.6422 3.53713 56.7688 3.27586 56 3.11272L56.0529 2.87231H59.7962C60.2726 2.87231 60.7024 3.18141 60.8107 3.71621L61.737 8.50606L64.0259 2.87354H66.3361ZM83.2222 11.1496H81.1883L80.9231 9.91313H78.1013L77.6427 11.1496H75.3324L78.6318 3.48085C78.7904 3.11287 79.1459 2.87369 79.5682 2.87369H81.4466L83.2222 11.1496ZM78.7344 8.21657L79.8926 5.10836L80.5591 8.21657H78.7344ZM67.6607 11.1496L69.4794 2.87369H67.2814L65.4614 11.1496H67.6607Z" fill="#1A1F71"/></g><defs><clipPath id="clip_cbd1"><rect width="83.2222" height="14" fill="white"/></clipPath></defs></svg>
            </div>
          </div>

          <!-- Expanded content -->
          <div class="expandable-content" id="cardExpanded">
           <div class="expandable-inner" onclick="event.stopPropagation()">

            <!-- PANEL 1: Saved card (default) -->
            <div class="card-panel active" id="panelSaved">
             <div class="card-panel-inner">
              <a class="text-link" href="javascript:void(0)" onclick="event.preventDefault()">Not your card?</a>
              <div class="saved-card-row">
                <div class="saved-card-img"><svg width="100" height="64" viewBox="0 0 100 64" fill="none" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="cg1" x1="0" y1="0" x2="100" y2="64" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="#1c2e4a"/><stop offset="100%" stop-color="#243b6e"/></linearGradient></defs><rect width="100" height="64" rx="8" fill="url(#cg1)"/><rect x="8" y="22" width="18" height="14" rx="3" fill="#f0c040" opacity="0.9"/><rect x="8" y="26" width="18" height="2" fill="#c8960a" opacity="0.6"/><rect x="10" y="44" width="32" height="3" rx="1.5" fill="white" opacity="0.25"/><rect x="10" y="50" width="20" height="3" rx="1.5" fill="white" opacity="0.2"/><text x="91" y="20" font-family="Arial" font-size="11" font-weight="900" font-style="italic" fill="white" text-anchor="end">VISA</text></svg></div>
                <span class="saved-card-number" id="activeCardNumber">**** 5555</span>
                <a class="text-link" href="javascript:void(0)" onclick="event.preventDefault(); showCardPanel('list')">Change</a>
              </div>
              <div class="panel-footer">
                <div></div>
                <div class="ssl-badge">
                  <img src="./icons/ssl secure.svg" alt="" style="width:12px;height:12px;flex-shrink:0;">
                  <span>SSL Secure</span>
                </div>
              </div>
             </div>
            </div>

            <!-- PANEL 2: All saved cards -->
            <div class="card-panel" id="panelList">
             <div class="card-panel-inner">
              <a class="text-link" href="javascript:void(0)" onclick="event.preventDefault()">Not your cards?</a>
              <div class="saved-cards-list">
                <div class="saved-card-row" data-last4="5555">
                  <div class="saved-card-img"><svg width="100" height="64" viewBox="0 0 100 64" fill="none" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="cg1" x1="0" y1="0" x2="100" y2="64" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="#1c2e4a"/><stop offset="100%" stop-color="#243b6e"/></linearGradient></defs><rect width="100" height="64" rx="8" fill="url(#cg1)"/><rect x="8" y="22" width="18" height="14" rx="3" fill="#f0c040" opacity="0.9"/><rect x="8" y="26" width="18" height="2" fill="#c8960a" opacity="0.6"/><rect x="10" y="44" width="32" height="3" rx="1.5" fill="white" opacity="0.25"/><rect x="10" y="50" width="20" height="3" rx="1.5" fill="white" opacity="0.2"/><text x="91" y="20" font-family="Arial" font-size="11" font-weight="900" font-style="italic" fill="white" text-anchor="end">VISA</text></svg></div>
                  <span class="saved-card-number">**** 5555</span>
                  <span class="saved-card-current">Current</span>
                </div>
                <div class="saved-card-row selectable" data-last4="2323" onclick="chooseCard('2323')">
                  <div class="saved-card-img"><svg width="100" height="64" viewBox="0 0 100 64" fill="none" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="cg2" x1="0" y1="0" x2="100" y2="64" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="#1a0533"/><stop offset="100%" stop-color="#2d1460"/></linearGradient></defs><rect width="100" height="64" rx="8" fill="url(#cg2)"/><rect x="8" y="22" width="18" height="14" rx="3" fill="#f0c040" opacity="0.9"/><rect x="8" y="26" width="18" height="2" fill="#c8960a" opacity="0.6"/><rect x="10" y="44" width="32" height="3" rx="1.5" fill="white" opacity="0.25"/><rect x="10" y="50" width="20" height="3" rx="1.5" fill="white" opacity="0.2"/><circle cx="78" cy="48" r="9" fill="#EB001B" opacity="0.85"/><circle cx="88" cy="48" r="9" fill="#F79E1B" opacity="0.85"/><path d="M83 42a9 9 0 010 12 9 9 0 000-12z" fill="#FF5F00" opacity="0.9"/></svg></div>
                  <span class="saved-card-number">**** 2323</span>
                  <span class="text-link">Choose</span>
                </div>
                <div class="saved-card-row selectable" data-last4="4235" onclick="chooseCard('4235')">
                  <div class="saved-card-img"><svg width="100" height="64" viewBox="0 0 100 64" fill="none" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="cg3" x1="0" y1="0" x2="100" y2="64" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="#0a2a1a"/><stop offset="100%" stop-color="#0e4429"/></linearGradient></defs><rect width="100" height="64" rx="8" fill="url(#cg3)"/><rect x="8" y="22" width="18" height="14" rx="3" fill="#f0c040" opacity="0.9"/><rect x="8" y="26" width="18" height="2" fill="#c8960a" opacity="0.6"/><rect x="10" y="44" width="32" height="3" rx="1.5" fill="white" opacity="0.25"/><rect x="10" y="50" width="20" height="3" rx="1.5" fill="white" opacity="0.2"/><text x="91" y="20" font-family="Arial" font-size="11" font-weight="900" font-style="italic" fill="white" text-anchor="end">VISA</text></svg></div>
                  <span class="saved-card-number">**** 4235</span>
                  <span class="text-link">Choose</span>
                </div>
              </div>
              <a class="text-link-small" href="javascript:void(0)" onclick="event.preventDefault()">View all saved cards <svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M3 2l3 3-3 3" stroke="#222" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
              <div class="enter-manual-btn" onclick="showCardPanel('manual')">
                <div class="enter-manual-left">
                  <div class="enter-manual-icon">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 3v10M3 8h10" stroke="#222" stroke-width="2" stroke-linecap="round"/></svg>
                  </div>
                  <span>Enter card manually</span>
                </div>
                <svg width="8" height="14" viewBox="0 0 8 14" fill="none"><path d="M1 1l6 6-6 6" stroke="#222" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </div>
              <div class="panel-footer">
                <a class="return-link" href="javascript:void(0)" onclick="event.preventDefault(); showCardPanel('saved')">
                  <svg width="8" height="14" viewBox="0 0 8 14" fill="none"><path d="M7 1L1 7l6 6" stroke="#222" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  <span>Return</span>
                </a>
                <div class="ssl-badge">
                  <img src="./icons/ssl secure.svg" alt="" style="width:12px;height:12px;flex-shrink:0;">
                  <span>SSL Secure</span>
                </div>
              </div>
             </div>
            </div>

            <!-- PANEL 3: Manual card entry -->
            <div class="card-panel" id="panelManual">
             <div class="card-panel-inner">
              <div class="card-form">
                <div class="fields-group">
                  <div class="field">
                    <label class="field-label">Card number</label>
                    <div class="field-input-wrap">
                      <div class="field-input-row">
                        <div class="field-icon" id="cardFieldIcon">
                          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <rect x="1.5" y="4" width="17" height="12" rx="2" stroke="#727272" stroke-width="1.8" fill="none"/>
                            <rect x="1.5" y="7" width="17" height="3" fill="#727272"/>
                          </svg>
                        </div>
                        <input type="text" id="cardNumber" placeholder="0000 0000 0000 0000" maxlength="19" inputmode="numeric" autocomplete="cc-number">
                      </div>
                      <div class="field-underline"></div>
                    </div>
                    <div class="field-error-msg" id="cardNumberError">Enter a valid card number</div>
                  </div>
                  <div class="field-row">
                    <div class="field">
                      <label class="field-label">Expiry date</label>
                      <div class="field-input-wrap">
                        <div class="field-input-row">
                          <input type="text" id="expiryDate" placeholder="MM / YY" maxlength="7" inputmode="numeric" autocomplete="cc-exp">
                        </div>
                        <div class="field-underline"></div>
                      </div>
                      <div class="field-error-msg" id="expiryError">Invalid or expired date</div>
                    </div>
                    <div class="field">
                      <label class="field-label">CVC / CVV</label>
                      <div class="field-input-wrap">
                        <div class="field-input-row">
                          <input type="text" id="cvv" placeholder="CVV" maxlength="4" inputmode="numeric" autocomplete="cc-csc">
                          <div class="field-action">
                            <div class="cvv-info" id="cvvInfoBtn"><span>?</span>
                              <div class="cvv-tooltip-popup" id="cvvTooltip">
                                <div class="cvv-tooltip-card">
                                  <div class="cvv-tooltip-card-stripe"></div>
                                  <div class="cvv-tooltip-card-cvv" id="cvvTooltipCode">CVV</div>
                                </div>
                                <div class="cvv-tooltip-text" id="cvvTooltipText">3-digit security code on the back of your card</div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="field-underline"></div>
                      </div>
                      <div class="field-error-msg" id="cvvError">Invalid CVV code</div>
                    </div>
                  </div>
                </div>
                <div class="save-card-section">
                  <div class="checkbox-row" onclick="toggleCheckbox('saveCard')">
                    <div class="checkbox-box checked" id="saveCardBox">
                      <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M3 7l3 3 5-5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </div>
                    <div class="checkbox-label-row">
                      <span class="checkbox-label">Save your card</span>
                      <div class="brands-chip-small"><svg width="51" height="14" viewBox="0 0 51 14" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip_c2p2_sv)"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5969 0.971788C14.8472 0.730697 15.2441 0.732467 15.4923 0.975778L19.9895 6.43757C20.3032 6.74509 20.3001 7.25082 19.9826 7.55445L15.571 13.0598C15.4624 13.1638 15.3177 13.2218 15.1672 13.2218H11.463C10.941 13.2218 10.6812 12.5897 11.0528 12.2233L15.5731 6.99957L11.463 1.94401H9.81431L13.7451 6.43782C14.0659 6.74393 14.0661 7.25549 13.7457 7.56195L8.58099 13.0598C8.47226 13.1638 8.32759 13.2218 8.17709 13.2218H2.33327C1.04493 13.2218 0.000381238 12.1776 0.000183275 10.8893C-0.000215146 8.29635 0.000123868 5.70348 0.000372411 3.11057C0.000495932 1.82195 1.04515 0.777344 2.33378 0.777344H4.65491C4.97742 0.777344 5.23888 1.03851 5.23888 1.36068C5.23888 1.68284 4.97742 1.94401 4.65491 1.94401H2.72402C1.86491 1.94401 1.16846 2.64046 1.16846 3.49957C1.16846 5.8329 1.16846 8.16623 1.16846 10.4996C1.16846 11.3587 1.86491 12.0551 2.72402 12.0551H7.74494L12.4586 6.99957L7.93831 1.77584C7.56674 1.40947 7.82647 0.777344 8.34851 0.777344H11.9589C12.1094 0.777344 12.254 0.835382 12.3627 0.939347L16.8602 6.43718C17.1806 6.74365 17.1803 7.2552 16.8597 7.56132L12.9288 12.0551H14.6811L18.6877 6.99957L14.5969 1.94401C14.3405 1.69068 14.3372 1.2218 14.5969 0.971788Z" fill="#141413"/><path d="M25.6684 1.16623C25.6684 0.951455 25.4943 0.777344 25.2795 0.777344C25.0647 0.777344 24.8906 0.951455 24.8906 1.16623V12.8329C24.8906 13.0477 25.0647 13.2218 25.2795 13.2218C25.4943 13.2218 25.6684 13.0477 25.6684 12.8329V1.16623Z" fill="#141413"/><path d="M43.9589 1.80469H37.7109V12.1985H43.9589V1.80469Z" fill="#FF5F00"/><path d="M38.3568 6.99954C38.3552 4.97164 39.2693 3.05562 40.8355 1.80356C38.1747 -0.326235 34.3537 -0.0160118 32.0579 2.51621C29.762 5.04843 29.762 8.95246 32.0579 11.4847C34.3537 14.017 38.1747 14.3271 40.8355 12.1973C39.2687 10.9449 38.3547 9.02806 38.3568 6.99954Z" fill="#EB001B"/><path d="M50.5939 11.1695V10.9472H50.6833V10.9102H50.4688V10.9472H50.5581V11.1695H50.5939Z" fill="#F79E1B"/><path d="M51.0047 10.9099H50.9333L50.8618 11.0952L50.7903 10.9099H50.7188V11.1693H50.7724V10.9654L50.8318 11.1322H50.8976L50.955 10.9654V11.1693H51.0047V10.9099Z" fill="#F79E1B"/><path d="M51.3325 7.00209C51.3325 9.53278 49.9137 11.8413 47.6788 12.9471C45.4439 14.0531 42.7853 13.7622 40.832 12.1981C42.3975 10.9449 43.3117 9.02917 43.3117 7.00118C43.3117 4.97317 42.3975 3.0574 40.832 1.80428C42.7853 0.240174 45.4439 -0.0506988 47.6788 1.05519C49.9137 2.16108 51.3325 4.46958 51.3325 7.00026V7.00209Z" fill="#F79E1B"/></g><defs><clipPath id="clip_c2p2_sv"><rect width="51" height="14" fill="white"/></clipPath></defs></svg></div>
                    </div>
                  </div>
                  <div class="save-card-sub">
                    <span class="save-card-sub-text">Your data will be stored securely in</span>
                    <span class="save-card-sub-bold">Mastercard</span>
                    <a class="learn-more" href="javascript:void(0)" onclick="event.stopPropagation()">Learn more</a>
                  </div>
                </div>
              </div>
              <div class="panel-footer">
                <a class="return-link" href="javascript:void(0)" onclick="event.preventDefault(); showCardPanel('list')">
                  <svg width="8" height="14" viewBox="0 0 8 14" fill="none"><path d="M7 1L1 7l6 6" stroke="#222" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  <span>Return to saved cards</span>
                </a>
                <div class="ssl-badge">
                  <img src="./icons/ssl secure.svg" alt="" style="width:12px;height:12px;flex-shrink:0;">
                  <span>SSL Secure</span>
                </div>
              </div>
             </div>
            </div>
           </div>
          </div>
        </div>
        <hr class="payment-separator" id="sep-card-apple">

        <!-- Apple Pay -->
        <div class="payment-item" onclick="collapseAll()">
          <div class="payment-item-left">
            <div class="pm-icon">
              <img src="./icons/Applepay.svg" alt="Apple Pay" style="width:30px;height:30px;display:block;">
            </div>
            <div class="pm-info">
              <div class="pm-name">Apple Pay</div>
              <div class="pm-desc">Pay with Apple Pay</div>
            </div>
          </div>
        </div>
        <hr class="payment-separator">

        <!-- Google Pay -->
        <div class="payment-item" onclick="collapseAll()">
          <div class="payment-item-left">
            <div class="pm-icon">
              <img src="./icons/GPay.svg" alt="Google Pay" style="width:30px;height:30px;display:block;">
            </div>
            <div class="pm-info">
              <div class="pm-name">Google Pay</div>
              <div class="pm-desc">Pay with Google Pay</div>
            </div>
          </div>
        </div>
        <hr class="payment-separator">

        <!-- Instant Bank Transfer -->
        <div class="payment-item" onclick="collapseAll()">
          <div class="payment-item-left">
            <div class="pm-icon" style="overflow:hidden;padding:0;">
              <img src="./icons/BankTransfer2.svg" alt="Bank Transfer" style="width:40px;height:40px;border-radius:12px;display:block;">
            </div>
            <div class="pm-info">
              <div class="pm-name">Instant Bank Transfer</div>
              <div class="pm-desc">Choose your bank</div>
              <div class="bank-logos-mobile">
                <div class="bank-chip"><img src="./icons/Bank-Pekao.svg" alt="Pekao" style="height:20px;width:auto;border-radius:4px;"></div>
                <div class="bank-chip"><img src="./icons/Bank-Ing.svg" alt="ING" style="height:20px;width:auto;border-radius:4px;"></div>
                <div class="bank-chip"><img src="./icons/Bank-Mbank.svg" alt="mBank" style="height:20px;width:auto;border-radius:4px;"></div>
                <span class="bank-more">15+ more</span>
              </div>
            </div>
          </div>
          <div class="bank-logos">
            <div class="bank-chip"><img src="./icons/Bank-Pekao.svg" alt="Pekao" style="height:20px;width:auto;border-radius:4px;"></div>
            <div class="bank-chip"><img src="./icons/Bank-Ing.svg" alt="ING" style="height:20px;width:auto;border-radius:4px;"></div>
            <div class="bank-chip"><img src="./icons/Bank-Mbank.svg" alt="mBank" style="height:20px;width:auto;border-radius:4px;"></div>
            <span class="bank-more">15+ more</span>
          </div>
        </div>
        <hr class="payment-separator" id="sep-bank-zenapp">

        <!-- ZEN.COM App (expandable) -->
        <div class="expandable-item" id="zenappItem" onclick="expandItem('zenapp')">
          <div class="expandable-header">
            <div class="payment-item-left">
              <div class="pm-icon">
                <img src="./icons/zencomapp.svg" alt="ZEN.COM App" style="width:18px;height:18px;display:block;">
              </div>
              <div class="pm-info">
                <div class="pm-name-row">
                  <span class="pm-name">ZEN.COM App</span>
                  <div class="cashback-badge">
                    <img src="./icons/Icon-Cashback.svg" alt="" style="width:12px;height:12px;flex-shrink:0;">
                    <span>CASHBACK 2 EUR</span>
                  </div>
                </div>
                <div class="pm-desc">One-Scan Payment</div>
                <div class="app-only-chip app-only-mobile">
                  <img src="./icons/app-users-only.svg" alt="" style="width:12px;height:12px;flex-shrink:0;">
                  <span>App users only</span>
                </div>
              </div>
            </div>
            <div class="app-only-chip app-only-desktop">
              <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><rect x="3" y="1" width="6" height="10" rx="1" stroke="#727272" stroke-width="1.2" fill="none"/><line x1="4.5" y1="9" x2="7.5" y2="9" stroke="#727272" stroke-width="0.8" stroke-linecap="round"/></svg>
              <span>App users only</span>
            </div>
          </div>
          <div class="expandable-content" id="zenappExpanded">
            <div class="expandable-inner">
              <div class="redirect-info zenapp-desc-desktop">
                <img src="./icons/after-confirming.svg" alt="" style="width:16px;height:16px;flex-shrink:0;">
                <span>Make sure you have the ZEN.COM app installed. After clicking Pay, you'll see a QR code to scan and pay instantly.</span>
              </div>
              <div class="redirect-info zenapp-desc-mobile">
                <img src="./icons/after-confirming.svg" alt="" style="width:16px;height:16px;flex-shrink:0;">
                <span>Make sure you have the ZEN.COM app installed. After clicking Pay, you'll be redirected to the next step to securely provide your payment details.</span>
              </div>
            </div>
          </div>
        </div>
        <hr class="payment-separator" id="sep-zenapp-bank">

        <!-- ZEN.COM CashCard -->
        <div class="payment-item" onclick="collapseAll()">
          <div class="payment-item-left">
            <div class="pm-icon">
              <img src="./icons/zencomcashcard.svg" alt="ZEN.COM CashCard" style="width:22px;height:23px;display:block;margin-left:3px;">
            </div>
            <div class="pm-info">
              <div class="pm-name">ZEN.COM CashCard</div>
              <div class="pm-desc">Pay with prepaid card</div>
            </div>
          </div>
        </div>

        <!-- Extra methods (hidden by default) -->
        <div class="extra-methods" id="extraMethods">
          <div class="extra-methods-inner">
          <hr class="payment-separator">
          <div class="payment-item" onclick="collapseAll()">
            <div class="payment-item-left">
              <div class="pm-icon" style="overflow:hidden;padding:0;"><img src="./icons/Ideal.svg" alt="iDeal" style="width:40px;height:40px;border-radius:12px;display:block;"></div>
              <div class="pm-info"><div class="pm-name">iDeal</div></div>
            </div>
          </div>
          <hr class="payment-separator">
          <div class="payment-item" onclick="collapseAll()">
            <div class="payment-item-left">
              <div class="pm-icon" style="overflow:hidden;padding:0;"><img src="./icons/Skrill.svg" alt="Skrill" style="width:40px;height:40px;border-radius:12px;display:block;"></div>
              <div class="pm-info"><div class="pm-name">SKRILL</div></div>
            </div>
          </div>
          <hr class="payment-separator">
          <div class="payment-item" onclick="collapseAll()">
            <div class="payment-item-left">
              <div class="pm-icon" style="overflow:hidden;padding:0;"><img src="./icons/Netteler.svg" alt="Neteller" style="width:40px;height:40px;border-radius:12px;display:block;"></div>
              <div class="pm-info"><div class="pm-name">Neteller</div></div>
            </div>
          </div>
          <hr class="payment-separator">
          <div class="payment-item" onclick="collapseAll()">
            <div class="payment-item-left">
              <div class="pm-icon" style="overflow:hidden;padding:0;"><img src="./icons/Bancontact.svg" alt="Bancontact" style="width:40px;height:40px;border-radius:12px;display:block;"></div>
              <div class="pm-info"><div class="pm-name">Bancontact</div></div>
            </div>
          </div>
          <hr class="payment-separator">
          <div class="payment-item" onclick="collapseAll()">
            <div class="payment-item-left">
              <div class="pm-icon" style="overflow:hidden;padding:0;"><img src="./icons/UnionPay.svg" alt="UnionPay" style="width:40px;height:40px;border-radius:12px;display:block;"></div>
              <div class="pm-info"><div class="pm-name">UnionPay International</div></div>
            </div>
          </div>
          </div>
        </div>

        <!-- Show all / Show less -->
        <div class="show-all" id="showAllBtn" onclick="toggleShowAll()">
          <span id="showAllLabel">Show all payment methods</span>
          <svg id="showAllChevron" width="16" height="16" viewBox="0 0 16 16" fill="none" style="transition: transform 0.3s ease"><path d="M5 6.5L8 9.5L11 6.5" stroke="#222" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
      </div>

    </div>

    <!-- ════════ RIGHT COLUMN ════════ -->
    <div class="right-col">

      <div class="merchant-section">
        <div class="merchant-header">
          <div class="merchant-left">
            <div class="merchant-logo">
              <img src="./icons/super-merchant-logo.svg" alt="merchant">
            </div>
            <div class="merchant-info">
              <div class="merchant-label">Payment for:</div>
              <div class="merchant-name">super-merchant.com</div>
            </div>
          </div>
          <div class="lang-toggle">EN</div>
        </div>

        <!-- Currency tabs -->
        <div class="currency-tabs" id="currencyTabs">
          <div class="currency-tabs-label">Pay in:</div>
          <div class="currency-tabs-row">
            <div class="currency-tab active" data-currency="EUR" onclick="selectCurrency(this)">EUR</div>
            <div class="currency-tab" data-currency="PLN" onclick="selectCurrency(this)">PLN</div>
            <div class="currency-tab" data-currency="GBP" onclick="selectCurrency(this)">GBP</div>
          </div>
        </div>

        <div class="total-box">
          <div class="total-top-row">
            <div class="total-label">Total to pay</div>
            <div class="total-amount">
              <span class="amount" id="totalAmount">100.00</span>
              <span class="currency" id="totalCurrency">EUR</span>
              <span class="mobile-currency-chevron" id="mobileCurrChevron"><svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M3 4.5L6 7.5L9 4.5" stroke="#222" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
            </div>
          </div>
          <div class="exchange-rate-row" id="exchangeRateRow" style="display:none">
            <span class="exchange-rate-text" id="exchangeRateText"></span>
            <a class="exchange-rate-link" href="javascript:void(0)">Margin over ECB fx rates</a>
          </div>
        </div>
      </div>

      <div class="continue-section">
        <!-- State 1: No method selected — static disabled Continue -->
        <div class="static-btn-row" id="staticBtnRow">
          <div class="static-btn disabled">
            <span>Continue</span>
          </div>
        </div>

        <!-- State 2: Method selected — spring stepper canvas -->
        <div id="stepperWrap" style="display:none; width:100%; max-width:408px; height:60px; position:relative; flex-shrink:0;">
          <canvas id="stepperCanvas" style="width:100%; height:60px; cursor:pointer; display:block;"></canvas>
        </div>

        <div class="terms-text" id="termsText">
          By clicking "Continue" I accept <a href="javascript:void(0)"> <strong>ZEN.COM</strong> payment terms</a>
        </div>

        <!-- CashCard details row (visible on step 1 BLIK/Card and step 2) -->
        <div class="cashcard-details-row" id="cashcardDetailsRow">
          <div class="cashcard-details-left">
            <div class="cashcard-step-indicator">
              <div class="cashcard-step-dot active" id="cashcardStep1Dot"></div>
            </div>
            <div class="cashcard-details-text" id="cashcardStep1Text">
              Buying ZEN.COM CashCard from <a href="javascript:void(0)">distributor</a>
            </div>
          </div>
          <div class="cashcard-details-toggle" id="cashcardDetailsToggle" onclick="toggleCashcardDetails()">
            Details
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
              <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>
        <div class="cashcard-details-expanded" id="cashcardDetailsExpanded">
          <div class="cashcard-steps">
            <!-- step 1 text (dot is in the row above, line connects downward) -->
            <div class="cashcard-step cashcard-step--text-only">
              <div class="cashcard-step-indicator">
                <div class="cashcard-step-line"></div>
              </div>
              <div class="cashcard-step-text active" id="cashcardStep1Detail">
                By clicking "accept order" I accept <a href="javascript:void(0)">ZEN.COM CashCard distributor terms</a>.
              </div>
            </div>
            <!-- step 2 -->
            <div class="cashcard-step">
              <div class="cashcard-step-indicator">
                <div class="cashcard-step-dot"></div>
                <div class="cashcard-step-line"></div>
              </div>
              <div class="cashcard-step-text">
                Payment for super-merchant.com
              </div>
            </div>
            <!-- step 3 -->
            <div class="cashcard-step">
              <div class="cashcard-step-indicator">
                <div class="cashcard-step-dot"></div>
              </div>
              <div class="cashcard-step-text">
                Status
              </div>
            </div>
          </div>
        </div>

        <div class="mobile-steps" id="mobileSteps"></div>

        <!-- Payment secured badge -->
        <div class="payment-secured">
          <img src="./icons/ssl secure.svg" alt="" class="payment-secured-lock">
          <span class="payment-secured-text">Payment secured and provided by</span>
          <img src="./icons/zencom-logo.svg" alt="ZEN.COM" class="payment-secured-logo">
        </div>
      </div>

    </div>

  </div>
</div>

<!-- Bottom bar -->
<div class="bottom-bar">
  <div class="step">
    <div class="step-circle active">1</div>
    <div class="step-text">
      <div class="step-title active">Buying ZEN.COM CashCard</div>
      <div class="step-sub active">from <a href="javascript:void(0)" style="font-weight:700; text-decoration:underline; text-underline-offset:2px; color:inherit">distributor</a></div>
    </div>
  </div>
  <div class="step-divider"></div>
  <div class="step">
    <div class="step-circle inactive">2</div>
    <div class="step-text">
      <div class="step-title inactive">Payment</div>
      <div class="step-sub inactive">for super-merchant.com</div>
    </div>
  </div>
  <div class="step-divider"></div>
  <div class="step">
    <div class="step-circle inactive">3</div>
    <div class="step-text">
      <div class="step-title inactive">Status</div>
    </div>
  </div>
</div>

<script>
  // ── Mobile card detail view ──
  const isMobile = () => window.innerWidth <= 785;

  function enterMobileCardView() {
    if (isMobile()) {
      document.body.classList.add('mobile-card-view');
    }
  }

  function mobileBackToList() {
    document.body.classList.remove('mobile-card-view');
    collapseAll();
  }

  // ── Generic expand/collapse system ──
  let activeItem = null; // 'blik', 'card', 'zenapp', or null

  const items = {
    blik: {
      wrapper: 'blikItem',
      content: 'blikExpanded',
      brands: null,
      sepBefore: null,
      sepAfter: 'sep-blik-card',
    },
    zenapp: {
      wrapper: 'zenappItem',
      content: 'zenappExpanded',
      brands: null,
      sepBefore: 'sep-bank-zenapp',
      sepAfter: 'sep-zenapp-bank',
    },
    card: {
      wrapper: 'cardItem',
      content: 'cardExpanded',
      brands: null,
      sepBefore: 'sep-blik-card',
      sepAfter: 'sep-card-apple',
    }
  };

  function expandItem(id) {
    if (activeItem === id) { collapseItem(id, false); return; }

    // Collapse currently active first (instant)
    if (activeItem) {
      collapseItem(activeItem, true);
    }

    activeItem = id;
    const cfg = items[id];
    const wrapper = document.getElementById(cfg.wrapper);
    const content = document.getElementById(cfg.content);

    // Hide brands
    if (cfg.brands) {
      document.getElementById(cfg.brands).style.display = 'none';
    }

    // Fade separators
    if (cfg.sepBefore) document.getElementById(cfg.sepBefore).style.opacity = '0';
    if (cfg.sepAfter) document.getElementById(cfg.sepAfter).style.opacity = '0';

    // Expand
    wrapper.classList.add('expanded');

    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        content.classList.add('open');
      });
    });

    // Mobile: show card detail view
    if (id === 'card') enterMobileCardView();

    // Mobile: scroll expanded item fully into view (clear of bottom bar)
    if (id !== 'card' && isMobile()) {
      setTimeout(() => {
        const el = document.getElementById(cfg.wrapper);
        if (!el) return;
        const rect = el.getBoundingClientRect();
        const bottomBarH = document.querySelector('.bottom-bar')?.offsetHeight || 80;
        const padding = 12;
        const visibleBottom = window.innerHeight - bottomBarH - padding;
        if (rect.bottom > visibleBottom) {
          const extra = rect.bottom - visibleBottom;
          window.scrollBy({ top: extra, behavior: 'smooth' });
        }
      }, 500);
    }

    // BLIK: auto-select PLN, show only PLN pill (no other currencies)
    if (id === 'blik') {
      const plnTab = document.querySelector('.currency-tab[data-currency="PLN"]');
      if (plnTab) selectCurrency(plnTab);
      document.getElementById('currencyTabs')?.classList.add('blik-mode');
    }
  }

  function collapseItem(id, instant) {
    const cfg = items[id];
    if (!cfg) return;

    const wrapper = document.getElementById(cfg.wrapper);
    const content = document.getElementById(cfg.content);

    content.classList.remove('open');

    const finish = () => {
      wrapper.classList.remove('expanded');
      if (cfg.brands) {
        document.getElementById(cfg.brands).style.display = 'inline-flex';
      }
      if (cfg.sepBefore) document.getElementById(cfg.sepBefore).style.opacity = '1';
      if (cfg.sepAfter) document.getElementById(cfg.sepAfter).style.opacity = '1';
      // Reset card panels to default
      if (id === 'card') showCardPanel('saved');
      // BLIK: remove blik-mode from currency tabs
      if (id === 'blik') document.getElementById('currencyTabs')?.classList.remove('blik-mode');
    };

    if (instant) {
      finish();
    } else {
      setTimeout(finish, 450);
    }

    if (activeItem === id) activeItem = null;
  }

  function collapseAll() {
    if (activeItem) collapseItem(activeItem, false);
  }

  // ── Card panel switcher (animated) ──
  function showCardPanel(panel) {
    const panelMap = { saved: 'panelSaved', list: 'panelList', manual: 'panelManual' };
    // Remove active from all
    Object.values(panelMap).forEach(id => {
      document.getElementById(id).classList.remove('active');
    });
    // Activate target on next frame for smooth transition
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        document.getElementById(panelMap[panel]).classList.add('active');
      });
    });
  }

  // ── Choose a saved card ──
  function chooseCard(lastFour) {
    document.getElementById('activeCardNumber').textContent = '**** ' + lastFour;
    // Update card artwork in panelSaved to match selected card
    const sourceRow = document.querySelector(`#panelList .saved-card-row[data-last4="${lastFour}"]`);
    if (sourceRow) {
      const sourceImg = sourceRow.querySelector('.saved-card-img');
      const targetImg = document.querySelector('#panelSaved .saved-card-img');
      if (sourceImg && targetImg) {
        targetImg.innerHTML = sourceImg.innerHTML;
      }
    }
    // Update current/choose labels and reorder in card list
    const list = document.querySelector('#panelList .saved-cards-list');
    const rows = Array.from(list.querySelectorAll('.saved-card-row'));
    let currentRow = null;
    rows.forEach(row => {
      const num = row.querySelector('.saved-card-number');
      const currentEl = row.querySelector('.saved-card-current');
      const chooseEl = row.querySelector('.text-link');
      if (num && num.textContent.trim() === '**** ' + lastFour) {
        currentRow = row;
        // Remove selectable – this is now the current card
        row.classList.remove('selectable');
        row.removeAttribute('onclick');
        if (chooseEl) chooseEl.style.display = 'none';
        if (!currentEl) {
          const span = document.createElement('span');
          span.className = 'saved-card-current';
          span.textContent = 'Current';
          row.appendChild(span);
        } else { currentEl.style.display = ''; }
      } else {
        // Make the whole row selectable
        const digits = num ? num.textContent.trim().replace('**** ', '') : '';
        row.classList.add('selectable');
        row.onclick = function() { chooseCard(digits); };
        if (currentEl) currentEl.style.display = 'none';
        if (chooseEl) {
          chooseEl.style.display = '';
        } else {
          // Create a "Choose" span if one doesn't exist (e.g. for the initial current card)
          if (digits) {
            const span = document.createElement('span');
            span.className = 'text-link';
            span.textContent = 'Choose';
            row.appendChild(span);
          }
        }
      }
    });
    // Move current card to top of list
    if (currentRow && currentRow !== list.firstElementChild) {
      list.insertBefore(currentRow, list.firstElementChild);
    }
    showCardPanel('saved');
  }

  function toggleCheckbox(id) {
    event.stopPropagation();
    const box = id === 'saveCard' ? document.getElementById('saveCardBox') : document.getElementById('saveBrowserBox');
    box.classList.toggle('checked');
  }

  function selectCurrency(el) {
    document.querySelectorAll('.currency-tab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');

    // Animate amount out
    const amountEl = document.getElementById('totalAmount');
    const currencyEl = document.getElementById('totalCurrency');
    amountEl.classList.add('updating');
    currencyEl.classList.add('updating');

    const curr = el.dataset.currency;
    const baseAmount = 100.00;
    const rates = { EUR: 1, PLN: 4.4537, GBP: 0.8612 };
    const rate = rates[curr] || 1;
    const converted = (baseAmount * rate).toFixed(2);

    const totalBox = document.querySelector('.total-box');
    const rateRow = document.getElementById('exchangeRateRow');

    // After fade-out completes, update values and fade back in
    setTimeout(() => {
      amountEl.textContent = converted;
      currencyEl.textContent = curr;

      if (curr === 'EUR') {
        rateRow.style.display = 'none';
        totalBox.classList.remove('converted');
      } else {
        rateRow.style.display = 'flex';
        totalBox.classList.add('converted');
        document.getElementById('exchangeRateText').textContent = `1 EUR = ${rate.toFixed(4)} ${curr}`;
      }

      amountEl.classList.remove('updating');
      currencyEl.classList.remove('updating');
      if (activeItem === 'zenapp') drawStepper();
    }, 190);
  }

  // ── Cached DOM references ──
  const _cardNumberInput = document.getElementById('cardNumber');
  const _expiryInput = document.getElementById('expiryDate');
  const _cvvInput = document.getElementById('cvv');
  const _stepperWrap = document.getElementById('stepperWrap');
  const _staticBtnRow = document.getElementById('staticBtnRow');
  const _currencyTabs = document.getElementById('currencyTabs');
  const _bottomBar = document.querySelector('.bottom-bar');
  const _termsText = document.getElementById('termsText');
  const _totalAmount = document.getElementById('totalAmount');
  const _totalCurrency = document.getElementById('totalCurrency');
  const _exchangeRateRow = document.getElementById('exchangeRateRow');
  const _totalBox = document.querySelector('.total-box');
  const _totalAmountEl = document.querySelector('.total-amount');
  const _mobileSteps = document.getElementById('mobileSteps');
  const _mobileCurrChevron = document.getElementById('mobileCurrChevron');

  // ── Detected card brand ──
  let detectedBrand = ''; // '', 'visa', 'mc', 'amex'

  function setCardBrand(brand) {
    if (detectedBrand === brand) return;
    detectedBrand = brand;
    const panels = ['panelSaved', 'panelList', 'panelManual'];
    panels.forEach(pid => {
      const p = document.getElementById(pid);
      if (!p) return;
      p.classList.remove('brand-visa', 'brand-mc', 'brand-amex');
      if (brand) p.classList.add('brand-' + brand);
    });
    // Also update CVV maxlength + tooltip
    const cvvEl = document.getElementById('cvv');
    const tooltipText = document.getElementById('cvvTooltipText');
    const tooltipCode = document.getElementById('cvvTooltipCode');
    if (brand === 'amex') {
      if (cvvEl) cvvEl.maxLength = 4;
      if (tooltipText) tooltipText.textContent = '4-digit security code on the front of your Amex card';
      if (tooltipCode) tooltipCode.textContent = 'CID';
    } else {
      if (cvvEl) cvvEl.maxLength = 3;
      if (tooltipText) tooltipText.textContent = '3-digit security code on the back of your card';
      if (tooltipCode) tooltipCode.textContent = 'CVV';
    }
    // Update card icon in input field
    const iconWrap = document.getElementById('cardFieldIcon');
    if (iconWrap) {
      let img = iconWrap.querySelector('img');
      if (!brand) {
        // Back to default card SVG icon
        iconWrap.classList.remove('brand-active');
        if (img) { img.classList.remove('visible'); setTimeout(() => { if (img) img.remove(); }, 200); }
      } else {
        const srcMap = { visa: './icons/icon-visa.svg', mc: './icons/icon-mastercard.svg', amex: '' };
        const src = srcMap[brand];
        if (src) {
          iconWrap.classList.add('brand-active');
          if (!img) {
            img = document.createElement('img');
            img.alt = brand;
            iconWrap.appendChild(img);
          }
          if (img.src !== location.origin + '/' + src.replace('./', '')) img.src = src;
          requestAnimationFrame(() => requestAnimationFrame(() => img.classList.add('visible')));
        }
      }
    }
  }

  // ── CVV Tooltip toggle ──
  const _cvvInfoBtn = document.getElementById('cvvInfoBtn');
  if (_cvvInfoBtn) {
    _cvvInfoBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      const tip = document.getElementById('cvvTooltip');
      if (tip) tip.classList.toggle('visible');
    });
    document.addEventListener('click', function() {
      const tip = document.getElementById('cvvTooltip');
      if (tip) tip.classList.remove('visible');
    });
  }

  // ── Field validation helpers ──
  function setFieldError(fieldEl, errorId, show) {
    if (!fieldEl) return;
    if (show) {
      fieldEl.classList.add('error');
    } else {
      fieldEl.classList.remove('error');
    }
    const errEl = document.getElementById(errorId);
    // error msg visibility is controlled by CSS .field.error .field-error-msg { display: block }
  }

  function validateCardNumber() {
    const val = _cardNumberInput ? _cardNumberInput.value.replace(/\s/g, '') : '';
    const field = _cardNumberInput ? _cardNumberInput.closest('.field') : null;
    const valid = val.length >= 13 && val.length <= 19;
    setFieldError(field, 'cardNumberError', val.length > 0 && !valid);
    return valid || val.length === 0;
  }

  function validateExpiry() {
    const val = _expiryInput ? _expiryInput.value.replace(/\D/g, '') : '';
    const field = _expiryInput ? _expiryInput.closest('.field') : null;
    if (val.length < 4) { setFieldError(field, 'expiryError', false); return val.length === 0; }
    const mm = parseInt(val.slice(0, 2), 10);
    const yy = parseInt(val.slice(2, 4), 10);
    const now = new Date();
    const curYY = now.getFullYear() % 100;
    const curMM = now.getMonth() + 1;
    const valid = mm >= 1 && mm <= 12 && (yy > curYY || (yy === curYY && mm >= curMM));
    setFieldError(field, 'expiryError', !valid);
    return valid;
  }

  function validateCVV() {
    const val = _cvvInput ? _cvvInput.value : '';
    const field = _cvvInput ? _cvvInput.closest('.field') : null;
    const required = detectedBrand === 'amex' ? 4 : 3;
    const valid = val.length === required;
    setFieldError(field, 'cvvError', val.length > 0 && !valid);
    return valid || val.length === 0;
  }

  // ── Card number formatting + brand detection ──
  const cardInput = _cardNumberInput;
  if (cardInput) {
    cardInput.addEventListener('input', function(e) {
      let val = this.value.replace(/\D/g, '');
      // Amex: 15 digits, others: 16
      const maxLen = (val[0] === '3') ? 15 : 16;
      if (val.length > maxLen) val = val.slice(0, maxLen);
      let formatted = val.replace(/(.{4})/g, '$1 ').trim();
      this.value = formatted;
      // Brand detection
      const first = val[0] || '';
      const firstTwo = val.slice(0, 2);
      if (first === '4') setCardBrand('visa');
      else if (first === '5' || first === '2') setCardBrand('mc');
      else if (firstTwo === '34' || firstTwo === '37') setCardBrand('amex');
      else setCardBrand('');
      if (val.length > 0) validateCardNumber();
      else { const f = cardInput.closest('.field'); if(f) f.classList.remove('error'); }
      updateStepperDisabled();
    });
    cardInput.addEventListener('blur', function() {
      const val = this.value.replace(/\s/g, '');
      if (val.length > 0) validateCardNumber();
    });
  }

  // ── Expiry date formatting + validation ──
  const expiryInput = _expiryInput;
  if (expiryInput) {
    expiryInput.addEventListener('input', function(e) {
      let val = this.value.replace(/\D/g, '');
      if (val.length > 4) val = val.slice(0, 4);
      if (val.length >= 2) {
        val = val.slice(0, 2) + ' / ' + val.slice(2);
      }
      this.value = val;
      updateStepperDisabled();
    });
    expiryInput.addEventListener('blur', function() {
      const val = this.value.replace(/\D/g, '');
      if (val.length > 0) validateExpiry();
    });
  }

  // ── CVV input + validation ──
  const cvvInput = _cvvInput;
  if (cvvInput) {
    cvvInput.addEventListener('input', function(e) {
      const maxLen = detectedBrand === 'amex' ? 4 : 3;
      this.value = this.value.replace(/\D/g, '').slice(0, maxLen);
      if (this.value.length > 0) validateCVV();
      else { const f = cvvInput.closest('.field'); if(f) f.classList.remove('error'); }
      updateStepperDisabled();
    });
    cvvInput.addEventListener('blur', function() {
      if (this.value.length > 0) validateCVV();
    });
  }

  // ── Button, currency tabs, bottom bar visibility ──
  let stepperCurrentStep = 1;

  function updateButtonVisibility() {
    const staticRow = document.getElementById('staticBtnRow');
    const stepperWrap = document.getElementById('stepperWrap');
    const currTabs = document.getElementById('currencyTabs');
    const bottomBar = document.querySelector('.bottom-bar');

    if (activeItem) {
      staticRow.style.display = 'none';
      stepperWrap.style.display = 'block';
      currTabs.classList.add('visible'); // always show; blik-mode controls which tabs are shown
      bottomBar.classList.add('visible');
      if (activeItem === 'zenapp') {
        bottomBar.classList.remove('visible');
      }
      const chevron = document.getElementById('mobileCurrChevron');
      if (chevron) chevron.classList.add('visible');
      document.querySelector('.total-amount')?.classList.add('has-dropdown');
      updateTermsText();
      // Redraw canvas after layout update (double rAF for reliable sizing)
      requestAnimationFrame(() => { requestAnimationFrame(() => drawStepper()); });
    } else {
      staticRow.style.display = 'flex';
      stepperWrap.style.display = 'none';
      currTabs.classList.remove('visible');
      bottomBar.classList.remove('visible');
      document.getElementById('cashcardDetailsRow')?.classList.remove('visible');
      document.getElementById('cashcardDetailsExpanded')?.classList.remove('visible');
      document.getElementById('cashcardDetailsToggle')?.classList.remove('open');
      const chevron = document.getElementById('mobileCurrChevron');
      if (chevron) chevron.classList.remove('visible');
      document.querySelector('.total-amount')?.classList.remove('has-dropdown');
      const termsEl = document.getElementById('termsText');
      termsEl.style.display = '';
      termsEl.innerHTML = 'By clicking "Continue" I accept <a href="javascript:void(0)"> <strong>ZEN.COM</strong> payment terms</a>';
      resetCurrency();
      stepperCurrentStep = 1;
      stepper.step = 1;
      stepper.target = 0;
      stepper.value = 0;
      stepper.velocity = 0;
      stepper.running = false;
      drawStepper();
    }
    updateStepperDisabled();
  }

  function updateStep1Text() {
    const step1Detail = document.getElementById('cashcardStep1Detail');
    if (!step1Detail) return;
    if (stepperCurrentStep === 2) {
      step1Detail.innerHTML = 'Clicking \'Confirm payment\' confirms your purchase and acceptance of <a href="javascript:void(0)">ZEN.COM terms</a>.';
    } else {
      step1Detail.innerHTML = 'By clicking "accept order" I accept <a href="javascript:void(0)">ZEN.COM CashCard distributor terms</a>.';
    }
  }

  function updateTermsText() {
    const t = document.getElementById('termsText');
    const detailsRow = document.getElementById('cashcardDetailsRow');
    const detailsExpanded = document.getElementById('cashcardDetailsExpanded');
    const detailsToggle = document.getElementById('cashcardDetailsToggle');

    // Reset expanded
    if (detailsExpanded) detailsExpanded.classList.remove('visible');
    if (detailsToggle) detailsToggle.classList.remove('open');

    if (activeItem === 'zenapp') {
      t.style.display = '';
      t.innerHTML = 'By clicking "pay" I accept <a href="javascript:void(0)"> <strong>ZEN.COM</strong> payment terms</a>';
      if (detailsRow) detailsRow.classList.remove('visible');
      return;
    }

    // BLIK / Card — pokaż nowy tekst (bez details row na mobile)
    t.style.display = '';
    if (stepperCurrentStep === 2) {
      t.innerHTML = 'By clicking "confirm payment" I buy ZEN.COM CashCard from <a href="javascript:void(0)">distributor</a> and accept <a href="javascript:void(0)">ZEN.COM terms</a>.';
    } else {
      t.innerHTML = 'By clicking "accept order" I buy ZEN.COM CashCard from <a href="javascript:void(0)">distributor</a> and accept the <a href="javascript:void(0)">distributor terms</a>.';
    }
  }

  function toggleCashcardDetails() {
    const expanded = document.getElementById('cashcardDetailsExpanded');
    const toggle = document.getElementById('cashcardDetailsToggle');
    if (!expanded || !toggle) return;
    const isOpen = expanded.classList.contains('visible');
    if (isOpen) {
      expanded.classList.remove('visible');
      toggle.classList.remove('open');
    } else {
      expanded.classList.add('visible');
      toggle.classList.add('open');
    }
  }

  function resetCurrency() {
    document.querySelectorAll('.currency-tab').forEach(t => t.classList.remove('active'));
    document.querySelector('.currency-tab[data-currency="EUR"]').classList.add('active');
    document.getElementById('totalAmount').textContent = '100.00';
    document.getElementById('totalCurrency').textContent = 'EUR';
    document.getElementById('exchangeRateRow').style.display = 'none';
    document.querySelector('.total-box').classList.remove('converted');
  }

  // ── Show all / Show less ──
  let showAllOpen = false;
  function toggleShowAll() {
    showAllOpen = !showAllOpen;
    document.getElementById('extraMethods').classList.toggle('open', showAllOpen);
    document.getElementById('showAllLabel').textContent = showAllOpen ? 'Show less' : 'Show all payment methods';
    document.getElementById('showAllChevron').style.transform = showAllOpen ? 'rotate(180deg)' : '';
    if (showAllOpen) {
      setTimeout(() => {
        document.getElementById('showAllBtn').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 100);
    }
  }

  function updateStepperDisabled() {
    const cardExpanded = activeItem === 'card';
    const manualActive = document.getElementById('panelManual').classList.contains('active');
    if (cardExpanded && manualActive) {
      const num = cardInput ? cardInput.value.replace(/\s/g, '') : '';
      const exp = expiryInput ? expiryInput.value.replace(/\D/g, '') : '';
      const cvv = cvvInput ? cvvInput.value : '';
      const requiredCvv = detectedBrand === 'amex' ? 4 : 3;
      const minCard = detectedBrand === 'amex' ? 15 : 16;
      stepper.disabled = !(num.length >= minCard && exp.length === 4 && cvv.length >= requiredCvv);
    } else {
      stepper.disabled = false;
    }
    drawStepper();
  }

  // Hook into expand/collapse/panel to update button
  const _origExpand = expandItem;
  expandItem = function(id) { _origExpand(id); setTimeout(updateButtonVisibility, 50); };
  const _origCollapseAll = collapseAll;
  collapseAll = function() {
    document.body.classList.remove('mobile-card-view');
    _origCollapseAll();
    setTimeout(updateButtonVisibility, 500);
  };
  const _origShowPanel = showCardPanel;
  showCardPanel = function(p) { _origShowPanel(p); setTimeout(updateStepperDisabled, 50); };

  // ── Spring Stepper (Canvas) ──
  const CONN_PATH = new Path2D("M7.55762 0C9.24192 3.14729 12.5597 5.28906 16.3789 5.28906C20.1981 5.28906 23.5159 3.14729 25.2002 0H32V39H25.248C23.5797 35.8019 20.2357 33.6172 16.3789 33.6172C12.5222 33.6172 9.17806 35.8019 7.50977 39H0V0H7.55762Z");
  const H = 60, CIR = 60, CON = 32, OV = 15;
  const BADGE = 25, FONT = 17, BFONT = 14;

  function getStepperWidth() {
    const wrap = document.getElementById('stepperWrap');
    return wrap.offsetWidth || 408;
  }

  const lerp = (a, b, t) => a + (b - a) * t;
  const clamp = (v, lo = 0, hi = 1) => Math.max(lo, Math.min(hi, v));
  function lerpC(c1, c2, t) {
    t = clamp(t);
    const p = (s, i) => parseInt(s.slice(i, i + 2), 16);
    return [Math.round(lerp(p(c1,1),p(c2,1),t)), Math.round(lerp(p(c1,3),p(c2,3),t)), Math.round(lerp(p(c1,5),p(c2,5),t))];
  }

  const canvas = document.getElementById('stepperCanvas');
  const ctx = canvas.getContext('2d');

  // Prevent iOS tap highlight / green flash on canvas touch
  canvas.style.webkitTapHighlightColor = 'transparent';
  canvas.style.webkitUserSelect = 'none';
  canvas.style.userSelect = 'none';
  canvas.style.touchAction = 'manipulation';
  canvas.setAttribute('role', 'button');
  canvas.setAttribute('tabindex', '0');

  // Cross-browser rounded rect path helper — always works on iOS Safari
  function rrect(cx, x, y, w, h, r) {
    r = Math.min(r, w / 2, h / 2);
    cx.beginPath();
    cx.moveTo(x + r, y);
    cx.lineTo(x + w - r, y);
    cx.arcTo(x + w, y, x + w, y + r, r);
    cx.lineTo(x + w, y + h - r);
    cx.arcTo(x + w, y + h, x + w - r, y + h, r);
    cx.lineTo(x + r, y + h);
    cx.arcTo(x, y + h, x, y + h - r, r);
    cx.lineTo(x, y + r);
    cx.arcTo(x, y, x + r, y, r);
    cx.closePath();
  }

  let lastCanvasW = 0;

  function resizeCanvas() {
    const W = getStepperWidth();
    if (W === lastCanvasW) return;
    lastCanvasW = W;
    const S = 2;
    canvas.width = W * S;
    canvas.height = H * S;
    canvas.style.width = W + 'px';
    canvas.style.height = H + 'px';
  }

  const stepper = {
    step: 1, target: 0, value: 0, velocity: 0, disabled: false, hovered: false,
    stiffness: 300, damping: 20, mass: 1, lastTime: null, running: false,
    hoverT: 0, hoverRunning: false
  };

  // Cached icon for zenapp Pay button — white version via blob
  const _zenPayIcon = new Image();
  fetch('./icons/processed by.svg')
    .then(r => r.text())
    .then(svg => {
      const white = svg.replace(/fill="[^"]*"/g, 'fill="white"');
      const blob = new Blob([white], { type: 'image/svg+xml' });
      _zenPayIcon.src = URL.createObjectURL(blob);
      _zenPayIcon.onload = () => { if (activeItem === 'zenapp') drawStepper(); };
    });

  canvas.addEventListener('click', () => {
    if (stepper.disabled) return;
    // ZEN.COM App: single click → navigate directly to zen-payment
    if (activeItem === 'zenapp') {
      const paymentData = { method: 'zenapp' };
      paymentData.currency = document.getElementById('totalCurrency')?.textContent || 'EUR';
      paymentData.amount = document.getElementById('totalAmount')?.textContent || '100.00';
      try { sessionStorage.setItem('zenPaymentData', JSON.stringify(paymentData)); } catch(e) {}
      const badge = document.querySelector('.payment-secured');
      const mobileBadge = document.getElementById('mobileHeaderBadge');
      function triggerMobileBadgeShimmer() {
        if (mobileBadge) {
          mobileBadge.classList.remove('shimmer');
          void mobileBadge.offsetWidth;
          mobileBadge.classList.add('shimmer');
        }
      }
      if (badge) {
        badge.classList.remove('shimmer');
        void badge.offsetWidth;
        badge.classList.add('shimmer');
        triggerMobileBadgeShimmer();
        setTimeout(() => window.parent.postMessage({ type: 'navigate', to: '/zen-payment' }, '*'), 1050);
      } else {
        triggerMobileBadgeShimmer();
        setTimeout(() => window.parent.postMessage({ type: 'navigate', to: '/zen-payment' }, '*'), 1050);
      }
      return;
    }
    if (stepper.step === 2) {
      // Step 2 = "Confirm Payment" — save payment info and navigate to status page
      const paymentData = { method: activeItem };
      if (activeItem === 'card') {
        const rawCard = (document.getElementById('cardNumber')?.value || '').replace(/\s/g, '');
        const manualActive = document.getElementById('panelManual').classList.contains('active');
        if (manualActive && rawCard.length >= 4) {
          paymentData.cardLast4 = rawCard.slice(-4);
          const firstDigit = rawCard[0] || '';
          if (firstDigit === '4') paymentData.cardBrand = 'Visa';
          else if (firstDigit === '5' || firstDigit === '2') paymentData.cardBrand = 'Mastercard';
          else paymentData.cardBrand = 'Card';
        } else {
          // Use saved card number displayed
          const savedNumEl = document.getElementById('activeCardNumber');
          const savedText = savedNumEl ? savedNumEl.textContent.trim() : '';
          const last4Match = savedText.match(/(\d{4})$/);
          paymentData.cardLast4 = last4Match ? last4Match[1] : '5555';
          paymentData.cardBrand = 'Visa';
        }
      }
      paymentData.currency = document.getElementById('totalCurrency')?.textContent || 'EUR';
      paymentData.amount = document.getElementById('totalAmount')?.textContent || '100.00';
      try { sessionStorage.setItem('zenPaymentData', JSON.stringify(paymentData)); } catch(e) {}
      const nextRoute = activeItem === 'blik' ? '/blik' : activeItem === 'zenapp' ? '/zen-payment' : activeItem === 'card' ? '/3ds' : '/status';
      // Shimmer effect on badge before navigating
      const badge = document.querySelector('.payment-secured');
      const mobileBadge2 = document.getElementById('mobileHeaderBadge');
      if (mobileBadge2) {
        mobileBadge2.classList.remove('shimmer');
        void mobileBadge2.offsetWidth;
        mobileBadge2.classList.add('shimmer');
      }
      if (badge) {
        badge.classList.remove('shimmer');
        void badge.offsetWidth; // reflow to restart animation
        badge.classList.add('shimmer');
        setTimeout(() => window.parent.postMessage({ type: 'navigate', to: nextRoute }, '*'), 1050);
      } else {
        setTimeout(() => window.parent.postMessage({ type: 'navigate', to: nextRoute }, '*'), 1050);
      }
      return;
    }
    stepper.step = 2;
    stepper.target = 1;
    stepperCurrentStep = 2;
    updateTermsText();
    startSpring();
  });
  canvas.addEventListener('mouseenter', () => { stepper.hovered = true; startHoverAnim(); });
  canvas.addEventListener('mouseleave', () => { stepper.hovered = false; startHoverAnim(); });
  // Touch: prevent sticky hover on iOS, trigger action immediately on touchend
  canvas.addEventListener('touchstart', (e) => { e.preventDefault(); stepper.hovered = false; startHoverAnim(); }, { passive: false });
  canvas.addEventListener('touchend', (e) => {
    e.preventDefault();
    stepper.hovered = false;
    drawStepper();
    if (!stepper.disabled) {
      canvas.dispatchEvent(new MouseEvent('click', { bubbles: true }));
    }
  }, { passive: false });

  function startHoverAnim() {
    if (stepper.hoverRunning) return;
    stepper.hoverRunning = true;
    const duration = 200; // ms
    let startTime = null;
    const startT = stepper.hoverT;
    const targetT = stepper.hovered ? 1 : 0;
    function step(ts) {
      if (!startTime) startTime = ts;
      const elapsed = ts - startTime;
      const progress = Math.min(elapsed / duration, 1);
      stepper.hoverT = startT + (targetT - startT) * progress;
      drawStepper();
      if (progress < 1) {
        requestAnimationFrame(step);
      } else {
        stepper.hoverT = targetT;
        stepper.hoverRunning = false;
        drawStepper();
      }
    }
    requestAnimationFrame(step);
  }

  function startSpring() {
    if (stepper.running) return;
    stepper.running = true;
    stepper.lastTime = null;
    requestAnimationFrame(springStep);
  }

  function springStep(ts) {
    if (stepper.lastTime === null) { stepper.lastTime = ts; requestAnimationFrame(springStep); return; }
    const dt = Math.min((ts - stepper.lastTime) / 1000, 0.064);
    stepper.lastTime = ts;
    const disp = stepper.value - stepper.target;
    stepper.velocity += ((-stepper.stiffness * disp - stepper.damping * stepper.velocity) / stepper.mass) * dt;
    stepper.value += stepper.velocity * dt;
    if (Math.abs(stepper.velocity) < 0.001 && Math.abs(disp) < 0.001) {
      stepper.value = stepper.target;
      stepper.velocity = 0;
      stepper.running = false;
      drawStepper();
      return;
    }
    drawStepper();
    requestAnimationFrame(springStep);
  }

  function drawStepper() {
    resizeCanvas();
    const W = lastCanvasW || 408;
    const PW = W - CIR - CON + OV * 2;
    const S = 2;
    ctx.clearRect(0, 0, W * S, H * S);
    ctx.save();
    ctx.scale(S, S);

    const p = stepper.value;
    const cp = clamp(p);
    const dis = stepper.disabled;

    // ── ZEN.COM App: single Pay button ──
    if (activeItem === 'zenapp') {
      const amt = document.getElementById('totalAmount')?.textContent || '100.00';
      const cur = document.getElementById('totalCurrency')?.textContent || 'EUR';
      // Hover: #222 → #3a3a3a (lighter on hover)
      const hT = dis ? 0 : stepper.hoverT;
      const bgV = Math.round(lerp(34, 58, hT));
      rrect(ctx, 0, 0, W, H, H / 2);
      ctx.fillStyle = dis ? '#DFDFDF' : `rgb(${bgV},${bgV},${bgV})`;
      ctx.fill();
      ctx.font = `700 ${FONT}px Nunito, sans-serif`;
      const label = 'Pay ' + amt + ' ' + cur;
      if (_zenPayIcon && _zenPayIcon.complete && _zenPayIcon.naturalWidth > 0) {
        const ih = 20;
        const iw = _zenPayIcon.naturalWidth * (ih / _zenPayIcon.naturalHeight);
        const textW = ctx.measureText(label).width;
        const totalW = iw + 8 + textW;
        const startX = (W - totalW) / 2;
        ctx.drawImage(_zenPayIcon, startX, (H - ih) / 2, iw, ih);
        ctx.fillStyle = '#fff';
        ctx.textAlign = 'left'; ctx.textBaseline = 'middle';
        ctx.fillText(label, startX + iw + 8, H / 2 + 1);
      } else {
        ctx.fillStyle = '#fff';
        ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
        ctx.fillText(label, W / 2, H / 2 + 1);
      }
      ctx.restore();
      canvas.style.cursor = dis ? 'not-allowed' : 'pointer';
      return;
    }

    // Derived values
    const aW = lerp(PW, CIR, p);
    const aBg = dis && cp < 0.5 ? lerpC("#DFDFDF", "#DFDFDF", 0) : lerpC("#F7F7F7", "#22E243", cp);
    const bW = lerp(CIR, PW, p);
    const bL = lerp(W - CIR, W - PW, p);
    const bBg = cp <= 0.5 ? lerpC("#DFDFDF", "#222222", cp * 2) : lerpC("#222222", "#22E243", (cp - 0.5) * 2);
    const cL = lerp(PW - OV, CIR - OV, p);
    const cC = dis && cp < 0.5 ? lerpC("#DFDFDF", "#DFDFDF", 0) : lerpC("#DFDFDF", "#22E243", cp);

    const aPill = cp < 0.3 ? lerp(1, 0, cp / 0.3) : 0;
    const aCheck = cp > 0.5 ? lerp(0, 1, (cp - 0.5) / 0.5) : 0;
    const bBadge = cp < 0.3 ? lerp(1, 0, cp / 0.3) : 0;
    const bPill = cp > 0.5 ? lerp(0, 1, (cp - 0.5) / 0.5) : 0;

    const rgb = (c) => `rgb(${c[0]},${c[1]},${c[2]})`;

    // Connector (z-index: 1 — behind both pills)
    ctx.save();
    ctx.translate(cL, (H - 39) / 2);
    ctx.fillStyle = rgb(cC);
    ctx.fill(CONN_PATH);
    ctx.restore();

    // Element A: pill / green circle (z-index: 2)
    ctx.save();
    rrect(ctx, 0, 0, aW, H, 100);
    ctx.clip();
    ctx.fillStyle = rgb(aBg);
    ctx.fill();

    // A pill content
    if (aPill > 0.01) {
      ctx.globalAlpha = aPill;
      rrect(ctx, 2, 2, aW - 4, H - 4, 100);
      ctx.fillStyle = dis ? '#B5B5B5' : '#222';
      ctx.fill();
      // Badge "1"
      const bx = aW / 2 - 60, by = H / 2;
      ctx.beginPath();
      ctx.arc(bx, by, BADGE / 2, 0, Math.PI * 2);
      const hT1 = dis ? 0 : stepper.hoverT;
      ctx.fillStyle = `rgba(255,255,255,${0.10 + 0.20 * hT1})`;
      ctx.fill();
      ctx.strokeStyle = `rgba(255,255,255,${0.20 + 0.20 * hT1})`;
      ctx.lineWidth = 1;
      ctx.stroke();
      ctx.fillStyle = '#fff';
      ctx.font = `700 ${BFONT}px Nunito, sans-serif`;
      ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
      ctx.fillText('1', bx, by + 1);
      // Label
      ctx.font = `700 ${FONT}px Nunito, sans-serif`;
      ctx.fillText('Accept order', aW / 2 + 8, H / 2 + 1);
      ctx.globalAlpha = 1;
    }

    // A check
    if (aCheck > 0.01) {
      ctx.globalAlpha = aCheck;
      const cx2 = aW / 2, cy = H / 2;
      ctx.beginPath(); ctx.arc(cx2, cy, 13, 0, Math.PI * 2);
      ctx.fillStyle = '#222'; ctx.fill();
      ctx.strokeStyle = '#222'; ctx.lineWidth = 2; ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(cx2 - 5, cy + 0.5); ctx.lineTo(cx2 - 1.5, cy + 4); ctx.lineTo(cx2 + 5, cy - 3);
      ctx.strokeStyle = '#22E243'; ctx.lineWidth = 2.5;
      ctx.lineCap = 'round'; ctx.lineJoin = 'round'; ctx.stroke();
      ctx.globalAlpha = 1;
    }
    ctx.restore();

    // Element B: circle / pill (z-index: 2)
    ctx.save();
    rrect(ctx, bL, 0, bW, H, 100);
    ctx.clip();
    ctx.fillStyle = rgb(bBg);
    ctx.fill();

    // B badge "2" (inactive) — outlined circle on dark pill, fixed #B5B5B5 (no hover effect)
    if (bBadge > 0.01) {
      ctx.globalAlpha = bBadge;
      const bx = bL + bW / 2, by = H / 2;
      ctx.beginPath(); ctx.arc(bx, by, BADGE / 2, 0, Math.PI * 2);
      ctx.fillStyle = 'transparent';
      ctx.fill();
      ctx.strokeStyle = '#B5B5B5';
      ctx.lineWidth = 1.5; ctx.stroke();
      ctx.fillStyle = '#B5B5B5';
      ctx.font = `700 ${BFONT}px Nunito, sans-serif`;
      ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
      ctx.fillText('2', bx, by + 1);
      ctx.globalAlpha = 1;
    }

    // B pill content
    if (bPill > 0.01) {
      ctx.globalAlpha = bPill;
      rrect(ctx, bL + 2, 2, bW - 4, H - 4, 100);
      ctx.fillStyle = '#222'; ctx.fill();
      const bCenterX = bL + bW / 2;
      const bx = bCenterX - 80, by = H / 2;
      ctx.beginPath(); ctx.arc(bx, by, BADGE / 2, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(255,255,255,${0.10 + 0.20 * stepper.hoverT})`;
      ctx.fill();
      ctx.strokeStyle = `rgba(255,255,255,${0.20 + 0.20 * stepper.hoverT})`;
      ctx.lineWidth = 1; ctx.stroke();
      ctx.fillStyle = '#fff';
      ctx.font = `700 ${BFONT}px Nunito, sans-serif`;
      ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
      ctx.fillText('2', bx, by + 1);
      ctx.font = `700 ${FONT}px Nunito, sans-serif`;
      ctx.fillText('Confirm Payment', bCenterX + 10, H / 2 + 1);
      ctx.globalAlpha = 1;
    }
    ctx.restore();

    ctx.restore();

    // Update cursor
    canvas.style.cursor = dis ? 'not-allowed' : 'pointer';
  }

  // Initial draw
  resizeCanvas();
  drawStepper();

  // ── Desktop badge alignment ──
  // Pins .payment-secured just below .payment-card bottom edge on desktop.
  // On mobile badge is display:none (media query), so no-op there.
  const _badge = document.querySelector('.payment-secured');
  const _paymentCard = document.querySelector('.payment-card');

  function alignBadge() {
    if (!_badge || !_paymentCard) return;
    if (window.innerWidth <= 785) return;
    // Freeze badge position when "show all" is open
    if (showAllOpen) return;
    // Bottom edge of badge aligns with bottom edge of payment-card
    const cardBottom = _paymentCard.offsetTop + _paymentCard.offsetHeight;
    _badge.style.top = (cardBottom - _badge.offsetHeight) + 'px';
  }

  // Patch expandItem to realign badge (with transition)
  const _origExpandForBadge = expandItem;
  expandItem = function(id) {
    _origExpandForBadge(id);
    // Poll during expand animation so badge moves smoothly with card
    let t = 0;
    const poll = () => { alignBadge(); t += 16; if (t < 400) requestAnimationFrame(poll); };
    requestAnimationFrame(poll);
  };

  // Patch collapseItem to realign badge when method is deselected
  const _origCollapseItemForBadge = collapseItem;
  collapseItem = function(id, instant) {
    _origCollapseItemForBadge(id, instant);
    let t = 0;
    const poll = () => { alignBadge(); t += 16; if (t < 500) requestAnimationFrame(poll); };
    requestAnimationFrame(poll);
  };

  // Patch toggleShowAll to realign badge when show-all closes
  const _origToggleShowAll = toggleShowAll;
  toggleShowAll = function() {
    _origToggleShowAll();
    // After _origToggleShowAll, showAllOpen reflects the NEW state
    if (!showAllOpen) {
      let t = 0;
      const poll = () => { alignBadge(); t += 16; if (t < 500) requestAnimationFrame(poll); };
      requestAnimationFrame(poll);
    }
  };

  // Resize canvas on window resize (debounced 100ms)
  let _resizeTimer = null;
  window.addEventListener('resize', () => {
    if (_resizeTimer) clearTimeout(_resizeTimer);
    _resizeTimer = setTimeout(() => {
      alignBadge();
      if (document.getElementById('stepperWrap').style.display !== 'none') {
        resizeCanvas();
        drawStepper();
      }
    }, 100);
  });

  // Initial alignment (after fonts/images settle)
  requestAnimationFrame(() => { requestAnimationFrame(alignBadge); });
</script>

</body>
</html>
